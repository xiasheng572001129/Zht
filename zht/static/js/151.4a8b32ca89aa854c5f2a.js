webpackJsonp([151],{K8Qa:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("Xxa5"),i=n.n(a),o=n("exGp"),r=n.n(o),s=n("+ryu"),l=n("gPgF"),c={components:{pagination:s.a},data:function(){return{token:window.sessionStorage.getItem("bbytoken"),page:1,pageCount:1,tableData:[],oliImgVisible:!1,oliImgList:[],throughLoading:[],rejectedLoading:[]}},methods:{init:function(){var e=this;return r()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("admin/OilExamine/regAudit",{token:e.token,page:e.page,audit_status:0});case 3:1==(n=t.sent).data.code?(e.tableData=n.data.data.list,e.pageCount=n.data.data.rows):e.tableData=[],t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},oliImgDetails:function(e){var t=this;this.oliImgVisible=!0,this.oliImgList=e.shop_image,this.$nextTick(function(){var e=t.$refs.oliImg;Object(l.a)(e)})},through:function(e,t){var n=this;this.$confirm("此操作将通过审核, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(r()(i.a.mark(function a(){var o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,n.throughLoading[t]=!0,a.next=4,n.$axios.post("admin/DeTravelExamine/regThrough",{token:n.token,id:e.id,tour_name:e.oil_shop_name,phone:e.leader_phone});case 4:o=a.sent,n.throughLoading[t]=!1,1==o.data.code?(n.$message({message:o.data.msg,type:"success"}),n.init()):n.$message.error(o.data.msg),a.next=13;break;case 9:throw a.prev=9,a.t0=a.catch(0),n.throughLoading[t]=!1,a.t0;case 13:case"end":return a.stop()}},a,n,[[0,9]])}))).catch(function(){})},rejected:function(e,t){var n,a=this;this.$prompt("请输入驳回理由","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"请输入驳回理由"}).then((n=r()(i.a.mark(function n(o){var r,s=o.value;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a.rejectedLoading[t]=!0,n.next=4,a.$axios.post("admin/DeTravelExamine/regDismissal",{token:a.token,id:e.id,reason:s,phone:e.leader_phone,tour_name:e.oil_shop_name});case 4:r=n.sent,a.rejectedLoading[t]=!1,1==r.data.code?(a.$message({message:r.data.msg,type:"success"}),a.init()):a.$message.error(r.data.msg),n.next=13;break;case 9:throw n.prev=9,n.t0=n.catch(0),a.rejectedLoading[t]=!1,n.t0;case 13:case"end":return n.stop()}},n,a,[[0,9]])})),function(e){return n.apply(this,arguments)})).catch(function(){})}},mounted:function(){this.init()}},p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{prop:"oil_shop_name",label:"油站名称",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"oil_leader",label:"负责人",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{prop:"leader_phone",label:"负责人电话",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"油站图片",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.oliImgDetails(t.row)}}},[e._v("详情")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"详细地址",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:""+t.row.province+t.row.city+t.row.county+t.row.address}},[n("el-button",{staticClass:"ellipsis",attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v(e._s(""+t.row.province+t.row.city+t.row.county+t.row.address))])],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"申请时间",prop:"create_time",align:"center"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"small",loading:e.throughLoading[t.$index]},on:{click:function(n){return e.through(t.row,t.$index)}}},[e._v("通过")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small",loading:e.rejectedLoading[t.$index]},on:{click:function(n){return e.rejected(t.row,t.$index)}}},[e._v("驳回")])]}}])})],1),e._v(" "),n("el-dialog",{attrs:{title:"油站图片",center:"",width:"30%",visible:e.oliImgVisible},on:{"update:visible":function(t){e.oliImgVisible=t}}},[n("div",{staticStyle:{"text-align":"center"}},e._l(e.oliImgList,function(e,t){return n("img",{key:t,ref:"oliImg",refInFor:!0,staticStyle:{"margin-right":"10px"},attrs:{src:e,width:"100px",height:"100px"}})}),0)]),e._v(" "),n("div",{staticClass:"page_center"},[n("paging",{attrs:{"page-count":e.pageCount,page:e.page},on:{index:function(t){e.page=t,e.init()}}})],1)],1)};p._withStripped=!0;var d={render:p,staticRenderFns:[]},u=d;var g=!1;var m=n("VU/8")(c,u,!1,function(e){g||n("Q1uy")},"data-v-134ded1c",null);m.options.__file="src/pages/OilStation/Toexamine/unaudited/index.vue";t.default=m.exports},Q1uy:function(e,t,n){var a=n("i1ni");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("rjj0")("b386dc5a",a,!1,{})},i1ni:function(e,t,n){(e.exports=n("FZ+f")(!0)).push([e.i,"\n.ellipsis[data-v-134ded1c] {\n  width: 100px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 2;\n  margin: 0 auto;\n  text-align: center;\n}\n","",{version:3,sources:["F:/仲达集团/2020-3-18总后台管理系统/src/pages/OilStation/Toexamine/unaudited/src/pages/OilStation/Toexamine/unaudited/index.vue"],names:[],mappings:";AA0LA;EACA,aAAA;EACA,iBAAA;EACA,wBAAA;EACA,qBAAA;EACA,6BAAA;EACA,sBAAA;EACA,eAAA;EACA,mBAAA;CACA",file:"index.vue",sourcesContent:['<template>\n  <div>\n    <el-table :data="tableData"\n              style="width: 100%">\n      <el-table-column prop="oil_shop_name"\n                       label="油站名称"\n                       align="center">\n      </el-table-column>\n      <el-table-column prop="oil_leader"\n                       label="负责人"\n                       align="center">\n      </el-table-column>\n      <el-table-column prop="leader_phone"\n                       label="负责人电话"\n                       align="center">\n      </el-table-column>\n\n      <el-table-column label="油站图片"\n                       align="center">\n        <template slot-scope="scope">\n          <el-button type="text"\n                     @click="oliImgDetails(scope.row)">详情</el-button>\n        </template>\n      </el-table-column>\n      <el-table-column label="详细地址"\n                       align="center">\n        <template slot-scope="scope">\n          <el-popover placement="top-start"\n                      width="200"\n                      trigger="hover"\n                      :content="`${scope.row.province}${scope.row.city}${scope.row.county}${scope.row.address}`">\n            <el-button slot="reference"\n                       type="text"\n                       class="ellipsis">{{`${scope.row.province}${scope.row.city}${scope.row.county}${scope.row.address}`}}</el-button>\n          </el-popover>\n        </template>\n      </el-table-column>\n\n      <el-table-column label="申请时间"\n                       prop="create_time"\n                       align="center"></el-table-column>\n      <el-table-column label="操作"\n                       align="center">\n        <template slot-scope="scope">\n          <el-button type="primary"\n                     size="small"\n                     :loading="throughLoading[scope.$index]"\n                     @click="through(scope.row,scope.$index)">通过</el-button>\n          <el-button type="danger"\n                     size="small"\n                     :loading="rejectedLoading[scope.$index]"\n                     @click="rejected(scope.row,scope.$index)">驳回</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    \x3c!-- 油站图片详情 --\x3e\n    <el-dialog title="油站图片"\n               center\n               width="30%"\n               :visible.sync="oliImgVisible">\n      <div style="text-align:center">\n        <img v-for="(item,index) in oliImgList"\n             :key="index"\n             :src="item"\n             width="100px"\n             height="100px"\n             style="margin-right:10px"\n             ref="oliImg" />\n      </div>\n    </el-dialog>\n\n    \x3c!-- 分页 --\x3e\n    <div class="page_center">\n      <paging :page-count="pageCount"\n              :page="page"\n              @index="(e)=>{\n                    page =e,\n                    init()\n                }"></paging>\n      \x3c!--分页的组件--\x3e\n    </div>\n  </div>\n</template>\n\n<script>\nimport pagination from \'@/components/pagination/pagination\'\nimport Viewer from \'@/utils/Viewer\'\nexport default {\n  components: { pagination },\n  data () {\n    return {\n      token: window.sessionStorage.getItem(\'bbytoken\'),\n      page: 1,//当前页\n      pageCount: 1,\n      tableData: [],\n      oliImgVisible: false,\n      oliImgList: [],\n      throughLoading: [],\n      rejectedLoading: []\n\n    }\n  },\n  methods: {\n\n    async init () {\n      try {\n        let res = await this.$axios.post(\'admin/OilExamine/regAudit\', { token: this.token, page: this.page, audit_status: 0 })\n        if (res.data.code == 1) {\n          this.tableData = res.data.data.list\n          this.pageCount = res.data.data.rows;\n        } else {\n          this.tableData = []\n        }\n      } catch (err) {\n        throw (err)\n      }\n    },\n    //油站图片详情\n    oliImgDetails (item) {\n      this.oliImgVisible = true\n      this.oliImgList = item.shop_image\n      this.$nextTick(() => {\n        const img = this.$refs.oliImg;\n        Viewer(img)\n      })\n    },\n    //通过审核\n    through (item, index) {\n      this.$confirm(\'此操作将通过审核, 是否继续?\', \'提示\', {\n        confirmButtonText: \'确定\',\n        cancelButtonText: \'取消\',\n        type: \'warning\',\n        center: true\n      }).then(async () => {\n        try {\n\n          this.throughLoading[index] = true\n          const res = await this.$axios.post(\'admin/DeTravelExamine/regThrough\', { token: this.token, id: item.id, tour_name: item.oil_shop_name, phone: item.leader_phone })\n          this.throughLoading[index] = false\n          if (res.data.code == 1) {\n            this.$message({ message: res.data.msg, type: "success" })\n            this.init()\n          } else {\n            this.$message.error(res.data.msg)\n          }\n        } catch (err) {\n          this.throughLoading[index] = false\n          throw (err)\n        }\n      }).catch(() => { });\n    },\n    //驳回\n    rejected (item, index) {\n\n      this.$prompt(\'请输入驳回理由\', \'提示\', {\n        confirmButtonText: \'确定\',\n        cancelButtonText: \'取消\',\n        inputPattern: /\\S/,\n        inputErrorMessage: \'请输入驳回理由\'\n      }).then(async ({ value }) => {\n        try {\n\n          this.rejectedLoading[index] = true\n          const res = await this.$axios.post(\'admin/DeTravelExamine/regDismissal\', { token: this.token, id: item.id, reason: value, phone: item.leader_phone, tour_name: item.oil_shop_name })\n          this.rejectedLoading[index] = false\n          if (res.data.code == 1) {\n            this.$message({ message: res.data.msg, type: "success" })\n            this.init()\n          } else {\n            this.$message.error(res.data.msg)\n          }\n        } catch (err) {\n          this.rejectedLoading[index] = false\n          throw (err)\n        }\n      }).catch(() => { });\n    },\n  },\n  mounted () {\n    this.init()\n  }\n}\n<\/script>\n\n<style scoped>\n.ellipsis {\n  width: 100px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-box-orient: vertical;\n  -webkit-line-clamp: 2;\n  margin: 0 auto;\n  text-align: center;\n}\n</style>\n'],sourceRoot:""}])}});
//# sourceMappingURL=151.4a8b32ca89aa854c5f2a.js.map
webpackJsonp([53],{"282c":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("mvHQ"),a=t.n(r),i=t("Xxa5"),s=t.n(i),c=t("woOf"),o=t.n(c),l=t("exGp"),d=t.n(l),m=t("bOdI"),h=t.n(m),u=t("0xDb"),p=(t("mw3O"),t("E7z3"),{data:function(){var n;return n={seCurId:"",threeAuthList:[],list:[],token:window.sessionStorage.getItem("bbytoken"),page:0,pageCount:0,authList:[]},h()(n,"list",[]),h()(n,"provinceList",[]),h()(n,"currentProvince",""),h()(n,"cityList",[]),h()(n,"currentCity",""),h()(n,"addChannelVisible",!1),h()(n,"channelList",{name:"",num:"",photo:""}),h()(n,"channelRules",{name:{required:!0,message:"请输入渠道名称",trigger:"blur"},num:{required:!0,message:"请输入添加的卡数量",trigger:"blur"},photo:{required:!0,message:"请上传保险公司图片",trigger:"blur"}}),h()(n,"channelLoaading",!1),h()(n,"acitivIndex",0),h()(n,"checkedCompany",[]),h()(n,"status",0),n},computed:{CheckedChannel:function(){var n=[];return this.list.forEach(function(e){if(e.checked){n.push({channel_id:e.id,num:e.sur_num})}}),n}},methods:{getCompanyList:function(n){var e=this;return d()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("admin/ChannelSetCity/channelList",{token:e.token,city_id:n});case 3:r=t.sent,(a=r.data.data||[]).forEach(function(n){n=o()(n,{card_num:""})}),e.list=a||[],t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(0),t.t0;case 12:case"end":return t.stop()}},t,e,[[0,9]])}))()},getProvince:function(){var n=this;return d()(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u.c)();case 3:t=e.sent,n.provinceList=t||[],e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,n,[[0,7]])}))()},changeProvince:function(n){var e=this;return d()(s.a.mark(function t(){var r,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(u.b)(n);case 3:r=t.sent,e.cityList=r||[],e.currentCity="",a=r&&r.length>0?r[0].id:"",e.getCompanyList(a),t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(0),t.t0;case 13:case"end":return t.stop()}},t,e,[[0,10]])}))()},addChannel:function(){var n,e=this;this.$refs.channelForm.validate((n=d()(s.a.mark(function n(t){var r,a;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=15;break}return n.prev=1,r=e.cityList[e.acitivIndex]&&e.cityList[e.acitivIndex].id,e.channelLoaading=!0,n.next=6,e.$axios.post("admin/ChannelSetCity/channelAdd",o()(e.channelList,{token:e.token,city_id:r,types:2}));case 6:a=n.sent,e.channelLoaading=!1,1==a.data.code?(e.$message({message:a.data.msg,type:"success"}),e.addChannelVisible=!1,window.location.href=e.baseURL+"admin/Export/freeCode?id="+a.data.data+"&name="+e.channelList.name+"&num="+e.channelList.num+"&city_id="+r,e.getCompanyList(r)):(console.log(a),e.$message.error(a.data.msg)),n.next=15;break;case 11:throw n.prev=11,n.t0=n.catch(1),e.channelLoaading=!1,n.t0;case 15:case"end":return n.stop()}},n,e,[[1,11]])})),function(e){return n.apply(this,arguments)}))},handleAvatarSuccess:function(n){this.channelList=o()({},this.channelList,{photo:n})},handleRemove:function(){this.channelList.photo=""},Modify:function(n){var e=this;this.addChannelVisible=!0,this.$nextTick(function(){e.channelList=o()(e.channelList,n,{name:n.company})})},ModifyImg:function(){var n=this;return d()(s.a.mark(function e(){var t,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=n.cityList[n.acitivIndex]&&n.cityList[n.acitivIndex].id,n.channelLoaading=!0,e.next=5,n.$axios.post("admin/ChannelSetCity/updImg",{token:n.token,channel_id:n.channelList.id,photo:n.channelList.photo});case 5:r=e.sent,n.channelLoaading=!1,1==r.data.code?(n.$message({message:r.data.msg,type:"success"}),n.addChannelVisible=!1,n.getCompanyList(t)):n.$message.error(r.data.msg),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),n.channelLoaading=!1,e.t0;case 14:case"end":return e.stop()}},e,n,[[0,10]])}))()},addCityChannel:function(){var n=this;return d()(s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.$axios.post("admin/ChannelSetCity/channelCityAdd",{token:n.token,data:n.CheckedChannel,city_id:n.currentCity});case 3:1==(t=e.sent).data.code?(n.$message({message:t.data.msg,type:"success"}),n.init()):n.$message.error(t.data.msg),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,n,[[0,7]])}))()},handleSelectionChange:function(n){this.checkedCompany=n},changeCity:function(n){this.init()},remove:function(n){var e=this;this.$confirm("此操作将删除该保险公司, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(d()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("admin/ChannelSetCity/setStatus",{token:e.token,city_id:n.city_id,channel_id:n.id});case 3:(r=t.sent).data.msg?(e.$message({message:r.data.msg,type:"success"}),e.getCompanyList(n.city_id)):e.$message.error(r.data.msg),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,e,[[0,7]])}))).catch(function(){})},Export:function(){var n=[],e=!1;this.checkedCompany.forEach(function(t,r){n.push({city_id:t.city_id,channel_id:t.id,card_num:t.card_num}),e=!!t.card_num}),e?(this.getCompanyList(this.cityList[this.acitivIndex].id),window.location.href=this.baseURL+"admin/Export/manyExport?data="+a()(n)):this.$message({message:"请填写卡数量",type:"warning"})},erAuth:function(){var n=this,e=this.$route.query.id;this.curId=e,this.$axios.post("admin/Auth/erAuth",{token:window.sessionStorage.getItem("bbytoken"),id:e}).then(function(e){if(1==e.data.code){for(var t=e.data.data,r=0;r<t.length;r++)if(t[r].son){"保险公司设置"==t[r].name&&(n.seCurId=t[r].id,n.threeAuthList=t[r].son);for(var a=0;a<t[r].son.length;a++)t[r].action!=t[r].son[a].action&&(t[r].action=t[r].son[0].action),"发放卡密"==t[r].son[a].name&&"保险公司设置"==t[r].name&&(n.thCurId=t[r].son[a].id)}n.authList=t}else n.$alert(e.data.msg,"提示",{type:"error"})}).catch(function(n){alert(n)})}},mounted:function(){this.erAuth(),this.getProvince()}}),v=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",[t("ctbHead",n._l(n.authList,function(e){return t("router-link",{key:e.id,class:n.seCurId==e.id?"cur":"",attrs:{to:{path:e.action,query:{id:n.curId}},"v-key":e.id}},[n._v("\n      "+n._s(e.name)+"\n    ")])}),1),n._v(" "),t("div",{staticClass:"container"},[t("div",{staticClass:"quote"},[n._m(0),n._v(" "),t("div",{staticClass:"quote-nav"},n._l(n.threeAuthList,function(e){return t("router-link",{key:e.id,class:n.thCurId==e.id?"cur":"",attrs:{to:{path:e.action,query:{id:n.curId}}}},[n._v("\n          "+n._s(e.name)+"\n        ")])}),1)]),n._v(" "),t("div",{staticClass:"search"},[t("el-select",{attrs:{placeholder:"请选择省"},on:{change:n.changeProvince},model:{value:n.currentProvince,callback:function(e){n.currentProvince=e},expression:"currentProvince"}},n._l(n.provinceList,function(n,e){return t("el-option",{key:e,attrs:{label:n.name,value:n.id}})}),1),n._v(" "),t("el-button",{staticClass:"addChannel",attrs:{type:"primary",disabled:!(n.cityList&&n.cityList.length>0)},on:{click:function(e){n.addChannelVisible=!0,n.status=0}}},[n._v("添加保险公司")])],1),n._v(" "),t("div",{staticClass:"main"},[t("div",{staticClass:"main_area"},n._l(n.cityList,function(e,r){return t("div",{key:r,class:["main_city",n.acitivIndex==r?"activeClass":""],on:{click:function(t){n.acitivIndex=r,n.getCompanyList(e.id)}}},[n._v(n._s(e.name))])}),0),n._v(" "),t("div",{staticClass:"main_item"},[n.currentProvince?t("el-table",{attrs:{data:n.list},on:{"selection-change":n.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),n._v(" "),t("el-table-column",{attrs:{label:"保险公司图片",align:"center"},scopedSlots:n._u([{key:"default",fn:function(n){return[t("img",{staticClass:"photo",attrs:{src:n.row.photo}})]}}],null,!1,1090632904)}),n._v(" "),t("el-table-column",{attrs:{label:"保险公司",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[n._v("\n              "+n._s(e.row.company)+"\n\n            ")]}}],null,!1,4255045064)}),n._v(" "),t("el-table-column",{attrs:{label:"卡数量",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-input",{attrs:{placeholder:"请输入卡数量"},model:{value:e.row.card_num,callback:function(t){n.$set(e.row,"card_num",t)},expression:"scope.row.card_num"}})]}}],null,!1,2175358978)}),n._v(" "),t("el-table-column",{attrs:{label:"总卡数",align:"center",prop:"num"},scopedSlots:n._u([{key:"default",fn:function(e){return[n._v("\n              "+n._s(e.row.num)+"张\n            ")]}}],null,!1,2668361867)}),n._v(" "),t("el-table-column",{attrs:{label:"消耗数量",align:"center",prop:"num"},scopedSlots:n._u([{key:"default",fn:function(e){return[n._v("\n              "+n._s(e.row.consume)+"张\n            ")]}}],null,!1,893108433)}),n._v(" "),t("el-table-column",{attrs:{label:"剩余数量",align:"center",prop:"num"},scopedSlots:n._u([{key:"default",fn:function(e){return[n._v("\n              "+n._s(e.row.sur_num)+"张\n            ")]}}],null,!1,3937956224)}),n._v(" "),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return n.remove(e.row)}}},[n._v("删除")]),n._v(" "),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){n.status=1,n.Modify(e.row)}}},[n._v("修改")])]}}],null,!1,2242990556)})],1):n._e(),n._v(" "),n.checkedCompany&&n.checkedCompany.length>0?t("el-button",{staticClass:"main_confirm",attrs:{type:"primary"},on:{click:function(e){return n.Export()}}},[n._v("导出")]):n._e()],1)]),n._v(" "),t("el-dialog",{attrs:{title:0==n.status?"添加保险公司":"修改保险公司",center:"",visible:n.addChannelVisible,width:"30%"},on:{"update:visible":function(e){n.addChannelVisible=e},close:function(){return n.$refs.channelForm.resetFields()}}},[t("el-form",{ref:"channelForm",staticStyle:{width:"80%"},attrs:{"label-width":"120px",model:n.channelList,rules:n.channelRules}},[t("el-form-item",{attrs:{label:"保险公司名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入保险公司名称",disabled:1==n.status},model:{value:n.channelList.name,callback:function(e){n.$set(n.channelList,"name",e)},expression:"channelList.name"}})],1),n._v(" "),t("el-form-item",{attrs:{label:"卡数量",prop:"num"}},[t("el-input",{attrs:{placeholder:"请输入卡数量",disabled:1==n.status},model:{value:n.channelList.num,callback:function(e){n.$set(n.channelList,"num",e)},expression:"channelList.num"}})],1),n._v(" "),t("el-form-item",{attrs:{label:"图片:",prop:"photo"}},[t("el-upload",{attrs:{action:n.baseURL+"admin/Prize/cbImg",data:{token:n.token},name:"img","list-type":"picture-card",limit:1,"file-list":n.channelList.photo?[{url:n.channelList.photo}]:[],"on-success":n.handleAvatarSuccess,"on-remove":n.handleRemove}},[t("i",{staticClass:"el-icon-plus"})])],1),n._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:n.channelLoaading},on:{click:function(e){0==n.status?n.addChannel():n.ModifyImg()}}},[n._v(n._s(0==n.status?"添加":"修改"))])],1)],1)],1)],1)],1)};v._withStripped=!0;var A={render:v,staticRenderFns:[function(){var n=this.$createElement,e=this._self._c||n;return e("div",{staticClass:"quote-ele"},[e("i"),this._v("系统设置-保险公司设置-发放卡密\n      ")])}]},f=A;var g=!1;var C=t("VU/8")(p,f,!1,function(n){g||t("gV97")},"data-v-7161664c",null);C.options.__file="src/pages/freeMaintenance/issueCamilo.vue";e.default=C.exports},"MM/X":function(n,e,t){(n.exports=t("FZ+f")(!0)).push([n.i,'\n.photo[data-v-7161664c] {\r\n  width: 50px;\r\n  height: 50px;\r\n  vertical-align: middle;\n}\n.search[data-v-7161664c] {\r\n  margin: 20px 50px;\n}\n.main[data-v-7161664c] {\r\n  padding: 0 50px;\n}\n.main[data-v-7161664c]:after {\r\n  display: block;\r\n  content: "";\r\n  clear: both;\n}\n.main > div[data-v-7161664c] {\r\n  float: left;\n}\n.main_item[data-v-7161664c] {\r\n  width: 70%;\n}\n.main_item .el-checkbox[data-v-7161664c] {\r\n  line-height: 50px;\n}\n.main_item .el-col-1[data-v-7161664c] {\r\n  width: 2%;\n}\n.main_item .el-col-offset-1[data-v-7161664c] {\r\n  margin-left: 2%;\n}\n.main_item .el-col[data-v-7161664c] {\r\n  text-align: center;\n}\n.main_item-title[data-v-7161664c] {\r\n  text-align: center;\n}\n.main_area[data-v-7161664c] {\r\n  width: 15%;\n}\n.main_city[data-v-7161664c] {\r\n  margin: 10px 0;\r\n  font-size: 16px;\r\n  cursor: pointer;\n}\n.main_confirm[data-v-7161664c] {\r\n  float: right;\r\n  margin-top: 20px;\n}\n.activeClass[data-v-7161664c] {\r\n  color: #04bbfc;\n}\n.clear-border[data-v-7161664c] {\r\n  border-bottom: 1px solid #ccc;\n}\n.clear-border[data-v-7161664c] input {\r\n  border: none !important;\n}\n.addChannel[data-v-7161664c] {\r\n  margin-left: 20px;\n}\r\n',"",{version:3,sources:["F:/仲达集团/2020-3-18总后台管理系统/src/pages/freeMaintenance/src/pages/freeMaintenance/issueCamilo.vue"],names:[],mappings:";AA4bA;EACA,YAAA;EACA,aAAA;EACA,uBAAA;CACA;AACA;EACA,kBAAA;CACA;AACA;EACA,gBAAA;CACA;AACA;EACA,eAAA;EACA,YAAA;EACA,YAAA;CACA;AACA;EACA,YAAA;CACA;AACA;EACA,WAAA;CACA;AACA;EACA,kBAAA;CACA;AACA;EACA,UAAA;CACA;AACA;EACA,gBAAA;CACA;AACA;EACA,mBAAA;CACA;AACA;EACA,mBAAA;CACA;AACA;EACA,WAAA;CACA;AACA;EACA,eAAA;EACA,gBAAA;EACA,gBAAA;CACA;AACA;EACA,aAAA;EACA,iBAAA;CACA;AACA;EACA,eAAA;CACA;AACA;EACA,8BAAA;CACA;AAEA;EACA,wBAAA;CACA;AACA;EACA,kBAAA;CACA",file:"issueCamilo.vue",sourcesContent:['<template>\r\n  <div>\r\n    <ctbHead>\r\n      <router-link :class="seCurId==item.id? \'cur\':\'\'"\r\n                   v-for="item in authList"\r\n                   :key="item.id"\r\n                   :to="{path:item.action,query:{id:curId}}"\r\n                   :v-key="item.id">\r\n        {{item.name}}\r\n      </router-link>\r\n    </ctbHead>\r\n    <div class="container">\r\n      <div class="quote">\r\n        <div class="quote-ele">\r\n          <i></i>系统设置-保险公司设置-发放卡密\r\n        </div>\r\n        <div class="quote-nav">\r\n          <router-link :class="thCurId==item.id? \'cur\':\'\'"\r\n                       v-for="item in threeAuthList"\r\n                       :key="item.id"\r\n                       :to="{path:item.action,query:{id:curId}}">\r\n            {{item.name}}\r\n          </router-link>\r\n        </div>\r\n      </div>\r\n      <div class="search">\r\n        <el-select v-model="currentProvince"\r\n                   @change="changeProvince"\r\n                   placeholder="请选择省">\r\n          <el-option v-for="(item,index) in provinceList"\r\n                     :key="index"\r\n                     :label="item.name"\r\n                     :value="item.id"></el-option>\r\n        </el-select>\r\n        \x3c!-- <el-select v-model="currentCity"\r\n                   placeholder="请选择市"\r\n                   @change="changeCity">\r\n          <el-option v-for="(item,index) in cityList"\r\n                     :key="index"\r\n                     :label="item.name"\r\n                     :value="item.id"></el-option>\r\n        </el-select> --\x3e\r\n        <el-button type="primary"\r\n                   class="addChannel"\r\n                   @click="addChannelVisible=true,status=0"\r\n                   :disabled="!(cityList&&cityList.length>0)">添加保险公司</el-button>\r\n\r\n      </div>\r\n      <div class="main">\r\n        <div class="main_area">\r\n          <div :class="[\'main_city\',acitivIndex==index ? \'activeClass\' : \'\']"\r\n               v-for="(item,index) in cityList"\r\n               :key="index"\r\n               @click="acitivIndex=index,getCompanyList(item.id)">{{item.name}}</div>\r\n        </div>\r\n        <div class="main_item">\r\n          \x3c!-- <div>\r\n            <el-row :gutter="30">\r\n\r\n              <el-col :span="24">\r\n                <div v-for="(item,index) in list"\r\n                     :key="index">\r\n                  \r\n                </div>\r\n              </el-col>\r\n\r\n            </el-row>\r\n          </div> --\x3e\r\n          <el-table :data="list"\r\n                    v-if="currentProvince"\r\n                    @selection-change="handleSelectionChange">\r\n            <el-table-column type="selection"\r\n                             width="55">\r\n            </el-table-column>\r\n            <el-table-column label="保险公司图片"\r\n                             align=\'center\'>\r\n              <template slot-scope="scope">\r\n                <img :src="scope.row.photo"\r\n                     class="photo" />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label="保险公司"\r\n                             align="center">\r\n              <template slot-scope="scope">\r\n                {{scope.row.company}}\r\n\r\n              </template>\r\n            </el-table-column>\r\n\r\n            <el-table-column label="卡数量"\r\n                             align="center">\r\n              <template slot-scope="scope">\r\n                <el-input placeholder="请输入卡数量"\r\n                          v-model="scope.row.card_num" />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label="总卡数"\r\n                             align="center"\r\n                             prop="num">\r\n              <template slot-scope="scope">\r\n                {{scope.row.num}}张\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label="消耗数量"\r\n                             align="center"\r\n                             prop="num">\r\n              <template slot-scope="scope">\r\n                {{scope.row.consume}}张\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label="剩余数量"\r\n                             align="center"\r\n                             prop="num">\r\n              <template slot-scope="scope">\r\n                {{scope.row.sur_num}}张\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label="操作"\r\n                             align="center">\r\n              <template slot-scope="scope">\r\n                <el-button type="danger"\r\n                           size="small"\r\n                           @click="remove(scope.row)">删除</el-button>\r\n                <el-button type="primary"\r\n                           size="small"\r\n                           @click="status=1,Modify(scope.row)">修改</el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          <el-button type="primary"\r\n                     v-if="checkedCompany && checkedCompany.length>0"\r\n                     class="main_confirm"\r\n                     @click="Export()">导出</el-button>\r\n          \x3c!-- <el-row>\r\n            <el-col :span="1">\r\n              <el-checkbox v-model="item.checked"></el-checkbox>\r\n            </el-col>\r\n            <el-col :span="2">\r\n              <el-input class="clear-border"\r\n                        v-model="item.company"\r\n                        @change="(value)=>singleModify(value,item)" />\r\n            </el-col>\r\n            <el-col :span="2"\r\n                    :offset="1">\r\n              <el-input class="clear-border"\r\n                        v-model="item.sur_num"\r\n                        @change="(value)=>singleModify(value,item)" />\r\n            </el-col>\r\n            <el-col :span="1"\r\n                    :offset="1">\r\n              <el-button type="primary"\r\n                         size="small">导出</el-button>\r\n            </el-col>\r\n          </el-row> --\x3e\r\n        </div>\r\n      </div>\r\n      <el-dialog :title="status==0 ? \'添加保险公司\' : \'修改保险公司\'"\r\n                 center\r\n                 :visible.sync="addChannelVisible"\r\n                 width="30%"\r\n                 @close=\'()=>$refs.channelForm.resetFields()\'>\r\n        <el-form label-width="120px"\r\n                 style="width:80%"\r\n                 :model="channelList"\r\n                 :rules="channelRules"\r\n                 ref="channelForm">\r\n          <el-form-item label="保险公司名称"\r\n                        prop="name">\r\n            <el-input placeholder="请输入保险公司名称"\r\n                      v-model="channelList.name"\r\n                      :disabled="status==1" />\r\n          </el-form-item>\r\n          <el-form-item label="卡数量"\r\n                        prop="num">\r\n            <el-input placeholder="请输入卡数量"\r\n                      v-model="channelList.num"\r\n                      :disabled="status==1" />\r\n          </el-form-item>\r\n          <el-form-item label="图片:"\r\n                        prop="photo">\r\n            <el-upload :action=\'baseURL+"admin/Prize/cbImg"\'\r\n                       :data="{token:token}"\r\n                       name=\'img\'\r\n                       list-type="picture-card"\r\n                       :limit=\'1\'\r\n                       :file-list=\'channelList.photo ? [{url:channelList.photo}] : []\'\r\n                       :on-success="handleAvatarSuccess"\r\n                       :on-remove="handleRemove">\r\n              <i class="el-icon-plus"></i>\r\n            </el-upload>\r\n          </el-form-item>\r\n          <el-form-item>\r\n            <el-button type="primary"\r\n                       @click="status==0 ? addChannel() : ModifyImg()"\r\n                       :loading="channelLoaading">{{status==0 ? \'添加\' : \'修改\'}}</el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-dialog>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script type="text/ecmascript-6">\r\nimport { getPro, GET_City } from \'@/utils\'\r\nimport qs from \'qs\'\r\nimport obj from \'../../components/common\'\r\nexport default {\r\n  data () {\r\n    return {\r\n      seCurId: \'\',\r\n      threeAuthList: [],\r\n      list: [],\r\n      token: window.sessionStorage.getItem(\'bbytoken\'),\r\n      page: 0,\r\n      pageCount: 0,\r\n      authList: [],\r\n      list: [], //领卡渠道列表\r\n      provinceList: [], //省列表\r\n      currentProvince: \'\',//当前选中的省\r\n      cityList: [], //市列表\r\n      currentCity: \'\', //当前选中的市\r\n      addChannelVisible: false, //添加渠道弹框显示状态\r\n      channelList: {  //添加渠道数据\r\n        name: \'\', //渠道名称\r\n        num: \'\', //卡数量\r\n        photo: \'\',  //保险公司图片\r\n      },\r\n      channelRules: { //添加渠道form规则验证\r\n        name: { required: true, message: \'请输入渠道名称\', trigger: \'blur\' },\r\n        num: { required: true, message: \'请输入添加的卡数量\', trigger: \'blur\' },\r\n        photo: { required: true, message: \'请上传保险公司图片\', trigger: \'blur\' },\r\n      },\r\n      channelLoaading: false, //添加渠道loading\r\n      acitivIndex: 0,\r\n      checkedCompany: [],  //当前勾选的保险公司\r\n      status: 0   //0 是添加保险公司 1是修改保险公司\r\n    }\r\n  },\r\n  computed: {\r\n    CheckedChannel () {    //选中的渠道\r\n      let CheckedChannel = []\r\n      this.list.forEach(item => {\r\n        if (item.checked) {\r\n          let data = []\r\n          CheckedChannel.push({ channel_id: item.id, num: item.sur_num })\r\n        }\r\n      })\r\n      return CheckedChannel\r\n    }\r\n  },\r\n  methods: {\r\n\r\n    async getCompanyList (id) {\r\n\r\n      try {\r\n        const res = await this.$axios.post(\'admin/ChannelSetCity/channelList\', { token: this.token, city_id: id })\r\n        let data = res.data.data || []\r\n        data.forEach(item => {\r\n          item = Object.assign(item, { card_num: \'\' })\r\n        })\r\n        this.list = data || []\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n\r\n    },\r\n    async getProvince () {  //获取省\r\n      try {\r\n        const res = await getPro()\r\n        this.provinceList = res || []\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n    },\r\n    async changeProvince (id) {  //获取市\r\n      try {\r\n        const res = await GET_City(id)\r\n        this.cityList = res || []\r\n        this.currentCity = \'\'\r\n\r\n        let cityID = res && res.length > 0 ? res[0].id : \'\'\r\n\r\n        this.getCompanyList(cityID)\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n    },\r\n\r\n    addChannel () {  //添加保险公司\r\n      this.$refs.channelForm.validate(async valid => {\r\n        if (valid) {\r\n          try {\r\n            let id = this.cityList[this.acitivIndex] && this.cityList[this.acitivIndex].id\r\n            this.channelLoaading = true\r\n            const res = await this.$axios.post(\'admin/ChannelSetCity/channelAdd\', Object.assign(this.channelList, { token: this.token, city_id: id, types: 2 }))\r\n            this.channelLoaading = false\r\n            if (res.data.code == 1) {\r\n              this.$message({ message: res.data.msg, type: "success" })\r\n              this.addChannelVisible = false\r\n              window.location.href = `${this.baseURL}admin/Export/freeCode?id=${res.data.data}&name=${this.channelList.name}&num=${this.channelList.num}&city_id=${id}`\r\n              this.getCompanyList(id)\r\n            } else {\r\n              console.log(res)\r\n              this.$message.error(res.data.msg)\r\n            }\r\n          } catch (error) {\r\n            this.channelLoaading = false\r\n            throw (error)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    handleAvatarSuccess (res) {  //上传保险公司图片\r\n      this.channelList = Object.assign({}, this.channelList, { photo: res })\r\n    },\r\n    handleRemove () {  //删除保险公司图片\r\n      this.channelList.photo = \'\'\r\n    },\r\n    Modify (item) {  //修改保险公司图片\r\n      this.addChannelVisible = true\r\n      this.$nextTick(() => {\r\n        this.channelList = Object.assign(this.channelList, item, { name: item.company })\r\n      })\r\n\r\n\r\n    },\r\n    async ModifyImg () {\r\n      try {\r\n        let id = this.cityList[this.acitivIndex] && this.cityList[this.acitivIndex].id\r\n        this.channelLoaading = true\r\n        const res = await this.$axios.post(\'admin/ChannelSetCity/updImg\', { token: this.token, channel_id: this.channelList.id, photo: this.channelList.photo })\r\n        this.channelLoaading = false\r\n        if (res.data.code == 1) {\r\n          this.$message({ message: res.data.msg, type: "success" })\r\n          this.addChannelVisible = false\r\n          this.getCompanyList(id)\r\n        } else {\r\n          this.$message.error(res.data.msg)\r\n        }\r\n      } catch (error) {\r\n        this.channelLoaading = false\r\n        throw (error)\r\n      }\r\n    },\r\n    async addCityChannel () {\r\n      try {\r\n        const res = await this.$axios.post(\'admin/ChannelSetCity/channelCityAdd\', { token: this.token, data: this.CheckedChannel, city_id: this.currentCity })\r\n        if (res.data.code == 1) {\r\n          this.$message({ message: res.data.msg, type: \'success\' })\r\n          this.init()\r\n        } else {\r\n          this.$message.error(res.data.msg)\r\n        }\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n    },\r\n    handleSelectionChange (val) {  //获取选中的保险公司\r\n      this.checkedCompany = val\r\n    },\r\n    changeCity (id) {  //获取市\r\n      this.init()\r\n    },\r\n    remove (item) {  //删除保险公司\r\n      this.$confirm(\'此操作将删除该保险公司, 是否继续?\', \'提示\', {\r\n        confirmButtonText: \'确定\',\r\n        cancelButtonText: \'取消\',\r\n        type: \'warning\'\r\n      }).then(async () => {\r\n        try {\r\n          const res = await this.$axios.post(\'admin/ChannelSetCity/setStatus\', { token: this.token, city_id: item.city_id, channel_id: item.id })\r\n          if (res.data.msg) {\r\n            this.$message({ message: res.data.msg, type: "success" })\r\n            this.getCompanyList(item.city_id)\r\n          } else {\r\n            this.$message.error(res.data.msg)\r\n          }\r\n        } catch (error) {\r\n          throw (error)\r\n        }\r\n      }).catch(() => { });\r\n    },\r\n    Export () {  //导出\r\n      let data = [];\r\n      let required = false\r\n      this.checkedCompany.forEach((item, index) => {\r\n        data.push({ city_id: item.city_id, channel_id: item.id, card_num: item.card_num })\r\n        if (item.card_num) {\r\n          required = true\r\n        } else {\r\n          required = false\r\n        }\r\n      })\r\n      if (required) {  //必须填写卡数量\r\n        this.getCompanyList(this.cityList[this.acitivIndex].id)\r\n        window.location.href = `${this.baseURL}admin/Export/manyExport?data=${JSON.stringify(data)}`\r\n\r\n      } else {\r\n        this.$message({ message: \'请填写卡数量\', type: \'warning\' })\r\n      }\r\n\r\n    },\r\n    erAuth () {  //权限匹配\r\n      var id = this.$route.query.id;\r\n      this.curId = id;\r\n      this.$axios.post(\'admin/Auth/erAuth\', {\r\n        token: window.sessionStorage.getItem(\'bbytoken\'),\r\n        id: id\r\n      })\r\n        .then(res => {\r\n          if (res.data.code == 1) {\r\n            var arr = res.data.data;\r\n            for (var i = 0; i < arr.length; i++) {\r\n              if (arr[i].son) {\r\n                if (arr[i].name == \'保险公司设置\') {\r\n                  this.seCurId = arr[i].id;\r\n                  this.threeAuthList = arr[i].son;\r\n                }\r\n                for (var j = 0; j < arr[i].son.length; j++) {\r\n                  if (arr[i].action != arr[i].son[j].action) {\r\n                    arr[i].action = arr[i].son[0].action;\r\n                  }\r\n                  if (arr[i].son[j].name == \'发放卡密\' && arr[i].name == \'保险公司设置\') {\r\n                    this.thCurId = arr[i].son[j].id;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            this.authList = arr;\r\n          } else {\r\n            this.$alert(res.data.msg, \'提示\', { type: \'error\' });\r\n          }\r\n        })\r\n        .catch(err => {\r\n          alert(err);\r\n        })\r\n    }\r\n  },\r\n  mounted () {\r\n    this.erAuth();\r\n    this.getProvince()\r\n  },\r\n}\r\n<\/script>\r\n<style scoped>\r\n.photo {\r\n  width: 50px;\r\n  height: 50px;\r\n  vertical-align: middle;\r\n}\r\n.search {\r\n  margin: 20px 50px;\r\n}\r\n.main {\r\n  padding: 0 50px;\r\n}\r\n.main:after {\r\n  display: block;\r\n  content: "";\r\n  clear: both;\r\n}\r\n.main > div {\r\n  float: left;\r\n}\r\n.main_item {\r\n  width: 70%;\r\n}\r\n.main_item .el-checkbox {\r\n  line-height: 50px;\r\n}\r\n.main_item .el-col-1 {\r\n  width: 2%;\r\n}\r\n.main_item .el-col-offset-1 {\r\n  margin-left: 2%;\r\n}\r\n.main_item .el-col {\r\n  text-align: center;\r\n}\r\n.main_item-title {\r\n  text-align: center;\r\n}\r\n.main_area {\r\n  width: 15%;\r\n}\r\n.main_city {\r\n  margin: 10px 0;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n}\r\n.main_confirm {\r\n  float: right;\r\n  margin-top: 20px;\r\n}\r\n.activeClass {\r\n  color: #04bbfc;\r\n}\r\n.clear-border {\r\n  border-bottom: 1px solid #ccc;\r\n}\r\n\r\n.clear-border >>> input {\r\n  border: none !important;\r\n}\r\n.addChannel {\r\n  margin-left: 20px;\r\n}\r\n</style>\r\n'],sourceRoot:""}])},gV97:function(n,e,t){var r=t("MM/X");"string"==typeof r&&(r=[[n.i,r,""]]),r.locals&&(n.exports=r.locals);t("rjj0")("f0a3daec",r,!1,{})},mvHQ:function(n,e,t){n.exports={default:t("qkKv"),__esModule:!0}},qkKv:function(n,e,t){var r=t("FeBl"),a=r.JSON||(r.JSON={stringify:JSON.stringify});n.exports=function(n){return a.stringify.apply(a,arguments)}}});
//# sourceMappingURL=53.35d0b5986f4581fcc037.js.map
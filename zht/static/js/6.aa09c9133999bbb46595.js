webpackJsonp([6],{Cdx3:function(e,n,t){var r=t("sB3e"),i=t("lktj");t("uqUo")("keys",function(){return function(e){return i(r(e))}})},FkYf:function(e,n,t){var r=t("iOG8");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t("rjj0")("5c7881ec",r,!1,{})},"NAu/":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("woOf"),i=t.n(r),a=t("Gu7T"),s=t.n(a),c=t("fZjL"),o=t.n(c),l=t("Xxa5"),d=t.n(l),h=t("//Fk"),p=t.n(h),u=t("d7EF"),m=t.n(u),g=t("exGp"),A=t.n(g),y=t("0xDb"),v={data:function(){return{list:[],token:window.sessionStorage.getItem("bbytoken"),page:0,pageCount:0,authList:[],uploadUrl:this.baseURL,threeAuthList:[],addVisible:!1,tableLoading:!1,loading:!1,province:"",listQuery:{company:"",type_channel:2,type:2,phone:"",num:500,provinceID:[]},state:1,provinceList:[],isIndeterminate:!1,checkAll:!1,rules:{company:{required:!0,message:"名称不能为空",trigger:"blur"},num:{required:!0,message:"卡数量不能为空",trigger:"blur"}},cityList:[],cityVisible:!1,cityIsIndeterminate:!1,cityCheckAll:!1,cityChecked:[],provinceID:[],cityID:[],provinceIndex:0,currentCity:[],defaultAll:[],getCheckedKeys:[],countyList:[],codeLoading:[],exportLoading:[],codeVisible:!1,codeList:[],codePageCount:1,codePage:1,currentCode:{},cardNum:"",remainingNum:""}},computed:{isAllChecked:function(){var e=this.provinceList.length,n=this.listQuery.provinceID.length,t=this.cityChecked.length,r=[];return this.provinceList.forEach(function(e){e.city.forEach(function(e){r.push(e)})}),e==n&&r.length==t}},watch:{"listQuery.province_name":{deep:!0,handler:function(e){e&&this.provinceChange(e)}},"listQuery.city":{deep:!0,handler:function(e){e&&this.cityChange(e)}},"listQuery.county":{deep:!0,handler:function(e){}}},methods:{paging:function(e){this.page=e,this.init()},init:function(){var e=this;return A()(d.a.mark(function n(){var t,r,i,a;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.tableLoading=!0,n.next=3,p.a.all([e.getList(),e.getArea()]);case 3:t=n.sent,r=m()(t,2),i=r[0],a=r[1],e.list=i.data.data.list||[],e.pageCount=i.data.data.rows||1,e.provinceList=a||[],e.tableLoading=!1;case 11:case"end":return n.stop()}},n,e)}))()},getList:function(){var e=this;return A()(d.a.mark(function n(){return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$axios.post("admin/SystemSetup/systemLists",{token:e.token,page:e.page,province:e.province});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,e)}))()},openAdd:function(e,n){var t=this;return A()(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$nextTick(function(){t.$refs.tree.setCheckedKeys(t.defaultAll),t.getCheckedKeys=t.$refs.tree.getCheckedKeys(),t.checkAll=!0});case 1:case"end":return e.stop()}},e,t)}))()},getArea:function(){var e,n=this;return new p.a((e=A()(d.a.mark(function e(t,r){var i,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.c)();case 3:i=e.sent,a=[],i.forEach(function(){var e=A()(d.a.mark(function e(t,r){var i,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.b)(t.id);case 2:i=e.sent,s=[],i.forEach(function(e){s.push({id:e.id,label:e.name}),n.defaultAll.push(e.id)}),a.push({id:t.id,label:t.name,children:s}),n.defaultAll.push(t.id);case 7:case"end":return e.stop()}},e,n)}));return function(n,t){return e.apply(this,arguments)}}()),t(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r(e.t0);case 12:case"end":return e.stop()}},e,n,[[0,9]])})),function(n,t){return e.apply(this,arguments)}))},checkAllChange:function(){this.$refs.tree.setCheckedKeys(this.checkAll?this.defaultAll:[])},treeCheck:function(){this.checkAll=this.$refs.tree.getCheckedKeys().length==this.defaultAll.length},defaultData:function(e){var n=this;this.cardNum=e.num,this.remainingNum=e.sur_num;var t=e.province,r=[],a=[],c=!1;o()(t).forEach(function(e){var n=t[e].province_id,i=t[e].city_id;n&&r.push(n),i&&a.push.apply(a,s()(i)),c="全国"==t[e].province_name}),this.$nextTick(function(){n.getCheckedKeys=n.$refs.tree.getCheckedKeys(),n.$refs.tree.setCheckedKeys(c?n.defaultAll:a),n.listQuery=i()(n.listQuery,e),n.checkAll=c})},handleSuccess:function(e){this.listQuery=i()({},this.listQuery,{photo:e})},provinceChange:function(e){var n=[];this.provinceList.forEach(function(t){t.label==e&&(n=t.children)}),this.cityList=n},cityChange:function(e){var n=this;return A()(d.a.mark(function t(){var r,i;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e&&Object(y.a)(n.cityList,e),t.next=3,Object(y.d)(r);case 3:i=t.sent,n.countyList=i;case 5:case"end":return t.stop()}},t,n)}))()},getCityCheckedID:function(e){var n=[],t=[];return this.provinceList.forEach(function(e){t.push(e.id)}),e.forEach(function(e){t.includes(e)||n.push(e)}),n},add:function(){var e,n=this;console.log(this.listQuery),this.$refs.form.validate((e=A()(d.a.mark(function e(t){var r,a,s,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=18;break}return e.prev=1,n.getCityCheckedID(n.$refs.tree.getCheckedKeys()),r=n.$refs.tree.getCheckedKeys().length==n.getCheckedKeys.length,n.loading=!0,o=n.listQuery,a={company:o.company,type:o.type,photo:o.photo,type_channel:o.type_channel,phone:o.phone,num:o.num,province_name:o.province_name,city:o.city,address:o.address,county:o.county},s=n.getCityCheckedID(n.$refs.tree.getCheckedKeys())&&n.getCityCheckedID(n.$refs.tree.getCheckedKeys()).length>0?n.getCityCheckedID(n.$refs.tree.getCheckedKeys()).join(","):"",e.next=9,n.$axios.post("admin/SystemSetup/addGenre",i()({},a,{token:n.token,types:1,province:r?1:s}));case 9:c=e.sent,n.loading=!1,1==c.data.code?(n.$message({message:c.data.msg,type:"success"}),n.addVisible=!1,n.exportCode(i()(n.listQuery,{id:c.data.data})),n.init()):n.$message.error(c.data.msg),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(1),n.loading=!1,e.t0;case 18:case"end":return e.stop()}var o},e,n,[[1,14]])})),function(n){return e.apply(this,arguments)}))},Modify:function(){var e,n=this;this.$refs.form.validate((e=A()(d.a.mark(function e(t){var r,a,s,c;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=17;break}return e.prev=1,n.loading=!0,r=n.$refs.tree.getCheckedKeys().length==n.getCheckedKeys.length,o=n.listQuery,a={company:o.company,type:o.type,photo:o.photo,type_channel:o.type_channel,phone:o.phone,num:o.num,province_name:o.province_name,city:o.city,address:o.address,id:o.id,county:o.county},s=n.getCityCheckedID(n.$refs.tree.getCheckedKeys())&&n.getCityCheckedID(n.$refs.tree.getCheckedKeys()).length>0?n.getCityCheckedID(n.$refs.tree.getCheckedKeys()).join(","):"",e.next=8,n.$axios.post("admin/SystemSetup/updateInfo",i()({},a,{token:n.token,types:1,province:r?1:s}));case 8:c=e.sent,n.loading=!1,1==c.data.code?(n.$message({message:c.data.msg,type:"success"}),n.addVisible=!1,n.exportCode(n.listQuery),n.init()):n.$message.error(c.data.msg),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(1),n.loading=!1,e.t0;case 17:case"end":return e.stop()}var o},e,n,[[1,13]])})),function(n){return e.apply(this,arguments)}))},Setup:function(e){var n=this;return A()(d.a.mark(function t(){var r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$axios.post("admin/SystemSetup/updateStatus",{token:n.token,id:e.id,status:e.status});case 3:1==(r=t.sent).data.code?(n.$message({message:r.data.msg,type:"success"}),n.init()):n.$message.error(r.data.msg),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,n,[[0,7]])}))()},codeDetails:function(e){var n=this;return A()(d.a.mark(function t(){var r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n.codeVisible=!0,n.currentCode=e,t.next=5,n.$axios.post("admin/SystemSetup/codeDetail",{token:n.token,id:e.id,page:n.codePage});case 5:r=t.sent,n.codeList=r.data.data.list||[],n.codePageCount=r.data.data.rows||1,t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(0),t.t0;case 13:case"end":return t.stop()}},t,n,[[0,10]])}))()},createCode:function(e,n){var t=this;this.$confirm("您确定要生成"+e.num+"个激活码吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(A()(d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,t.codeLoading[n]=!0,r.next=4,t.$axios.post("admin/SystemSetup/createCode",{token:t.token,id:e.id,num:e.num});case 4:i=r.sent,t.codeLoading[n]=!1,1==i.data.code?(t.$message({message:i.data.msg,type:"success"}),t.init()):t.$message.error(i.data.msg),r.next=13;break;case 9:throw r.prev=9,r.t0=r.catch(0),t.codeLoading[n]=!1,r.t0;case 13:case"end":return r.stop()}},r,t,[[0,9]])}))).catch(function(){})},exportCode:function(e,n){console.log(e),window.location.href=this.baseURL+"admin/Login/freeCode?id="+e.id+"&name="+e.company+"&num="+(n?"":Number(e.num)+(Number(this.cardNum)-Number(this.remainingNum)))},erAuth:function(){var e=this,n=this.$route.query.id;this.curId=n,this.$axios.post("admin/Auth/erAuth",{token:window.sessionStorage.getItem("bbytoken"),id:n}).then(function(n){if(1==n.data.code){for(var t=n.data.data,r=0;r<t.length;r++)if(t[r].son){"免费保养设置"==t[r].name&&(e.seCurId=t[r].id,e.threeAuthList=t[r].son);for(var i=0;i<t[r].son.length;i++)t[r].action!=t[r].son[i].action&&(t[r].action=t[r].son[0].action),"领卡渠道"==t[r].son[i].name&&"免费保养设置"==t[r].name&&(e.thCurId=t[r].son[i].id)}e.authList=t}else e.$alert(n.data.msg,"提示",{type:"error"})}).catch(function(e){alert(e)})}},mounted:function(){this.erAuth(),this.init()}},f=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("ctbHead",e._l(e.authList,function(n){return t("router-link",{key:n.id,class:e.seCurId==n.id?"cur":"",attrs:{to:{path:n.action,query:{id:e.curId}},"v-key":n.id}},[e._v("\n      "+e._s(n.name)+"\n    ")])}),1),e._v(" "),t("div",{staticClass:"container"},[t("div",{staticClass:"quote"},[t("div",{staticClass:"quote-ele"},[t("i"),e._v("系统设置-免费保养设置-领卡渠道\n        "),t("el-button",{staticStyle:{float:"right",margin:"20px 40px 0 0"},attrs:{type:"primary"},on:{click:function(n){e.addVisible=!0,e.state=1,e.openAdd(!0)}}},[e._v("添加")])],1),e._v(" "),t("div",{staticClass:"quote-nav"},e._l(e.threeAuthList,function(n){return t("router-link",{key:n.id,class:e.thCurId==n.id?"cur":"",attrs:{to:{path:n.action,query:{id:e.curId}}}},[e._v("\n          "+e._s(n.name)+"\n        ")])}),1)]),e._v(" "),t("div",{staticStyle:{"margin-left":"20px"}},[t("el-select",{attrs:{placeholder:"请选择所查询的地区"},on:{change:function(n){e.page=1,e.init()}},model:{value:e.province,callback:function(n){e.province=n},expression:"province"}},[t("el-option",{attrs:{value:"1",label:"全国"}},[e._v("全国")]),e._v(" "),e._l(e.provinceList,function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.id}})})],2)],1),e._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.list}},[t("el-table-column",{attrs:{align:"center",prop:"company",label:"名称"}}),e._v(" "),t("el-table-column",{attrs:{label:"渠道类型",align:"center",prop:"channel_type_name"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",prop:"num",label:"生成数量/次"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",prop:"sur_num",label:"剩余数量"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"激活码详情"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.codeDetails(n.row)}}},[e._v("详情")])]}}])}),e._v(" "),t("el-table-column",{attrs:{align:"center",label:"地区"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click"}},[t("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("详情")]),e._v(" "),t("div",{staticClass:"areaDetails"},[t("h4",{staticStyle:{"text-align":"center"}},[e._v("地区详情")]),e._v(" "),n.row.province?t("div",[t("span",{staticStyle:{float:"left",width:"80%"}},e._l(n.row.province,function(n,r){return t("div",{key:r,staticClass:"area"},[t("p",{staticClass:"province"},[e._v(" "+e._s(n.province_name))]),e._v(" "),t("p",{staticClass:"city"},[e._v(e._s(n.city_name?n.city_name.join("、"):""))])])}),0)]):t("div",{staticStyle:{"text-align":"center","line-height":"100px","font-size":"18px"}},[e._v("\n                无\n              ")])])],1)]}}])}),e._v(" "),t("el-table-column",{attrs:{align:"center",prop:"create_time",label:"创建时间"}}),e._v(" "),t("el-table-column",{attrs:{label:"操作/是否显示",align:"center","min-width":"140px"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-switch",{attrs:{"active-value":1,"inactive-value":2,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(t){return e.Setup(n.row)}},model:{value:n.row.status,callback:function(t){e.$set(n.row,"status",t)},expression:"scope.row.status"}}),e._v(" "),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(t){e.addVisible=!0,e.state=2,e.defaultData(n.row)}}},[e._v("修改")]),e._v(" "),t("el-button",{attrs:{type:"primary",size:"mini",loading:e.codeLoading[n.$index],disabled:n.row.sur_num>0},on:{click:function(t){return e.createCode(n.row,n.$index)}}},[e._v("生成激活码")]),e._v(" "),t("el-button",{attrs:{type:"primary",size:"mini",loading:e.exportLoading[n.$index]},on:{click:function(t){return e.exportCode(n.row,!0)}}},[e._v("导出")])]}}])})],1),e._v(" "),t("div",{staticClass:"page_center"},[t("paging",{attrs:{"page-count":e.pageCount,page:e.page},on:{index:e.paging}})],1)],1),e._v(" "),t("el-dialog",{attrs:{center:"",title:1==e.state?"添加":"修改",visible:e.addVisible},on:{"update:visible":function(n){e.addVisible=n},close:function(){e.$refs.form.resetFields(),e.$refs.tree.setCheckedKeys([]),e.cardNum="",e.remainingNum=""}}},[t("el-form",{ref:"form",attrs:{"label-width":"100px",model:e.listQuery,rules:e.rules}},[t("el-form-item",{attrs:{label:"名称:",prop:"company"}},[t("el-input",{staticClass:"input",attrs:{placeholder:"请输出名称"},model:{value:e.listQuery.company,callback:function(n){e.$set(e.listQuery,"company",n)},expression:"listQuery.company"}})],1),e._v(" "),t("el-form-item",{attrs:{label:1==e.state?"卡数量":"消耗数量",prop:"num"}},[1!=e.state?t("span",[e._v("\n          "+e._s(e.cardNum-e.remainingNum)+"\n          +\n\n        ")]):e._e(),e._v(" "),t("el-input",{staticClass:"input",attrs:{placeholder:"请输入卡数量"},model:{value:e.listQuery.num,callback:function(n){e.$set(e.listQuery,"num",n)},expression:"listQuery.num"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"地区"}},[t("div",[t("el-checkbox",{on:{change:e.checkAllChange},model:{value:e.checkAll,callback:function(n){e.checkAll=n},expression:"checkAll"}},[e._v("全选")])],1),e._v(" "),t("el-tree",{ref:"tree",attrs:{data:e.provinceList,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultAll,props:""},on:{check:e.treeCheck}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(n){1==e.state?e.add():e.Modify()}}},[e._v(e._s(1==e.state?"添加":"修改"))])],1)],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"激活码详情",center:"",visible:e.codeVisible},on:{"update:visible":function(n){e.codeVisible=n}}},[t("el-table",{attrs:{data:e.codeList}},[t("el-table-column",{attrs:{label:"用户名称",prop:"name",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{label:"联系电话",prop:"phone",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{label:"维修厂名称",prop:"company",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{label:"激活码",prop:"code",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{label:"状态",align:"center"}},[[e._v("\n          已使用\n        ")]],2)],1),e._v(" "),t("div",{staticClass:"page_center"},[t("paging",{attrs:{"page-count":e.codePageCount,page:e.codePage},on:{index:function(n){e.codePage=n,e.codeDetails(e.currentCode)}}})],1)],1)],1)};f._withStripped=!0;var C={render:f,staticRenderFns:[]},b=C;var k=!1;var x=t("VU/8")(v,b,!1,function(e){k||t("FkYf")},"data-v-1be22086",null);x.options.__file="src/pages/Setup/channel/Receipt.vue";n.default=x.exports},fZjL:function(e,n,t){e.exports={default:t("jFbC"),__esModule:!0}},iOG8:function(e,n,t){(e.exports=t("FZ+f")(!0)).push([e.i,'\n.ellipsis[data-v-1be22086] {\r\n  width: 150px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 2;\n}\n.areaDetails[data-v-1be22086] {\r\n  max-height: 300px;\r\n  min-height: 100px;\r\n  overflow: auto;\n}\n.areaDetails .area[data-v-1be22086] {\r\n  padding: 10px 0;\r\n  border-bottom: 1px solid #cccccc;\n}\n.areaDetails .province[data-v-1be22086] {\r\n  font-size: 15px;\r\n  font-weight: 600;\n}\n.img[data-v-1be22086] {\r\n  width: 70px;\r\n  height: 70px;\n}\n.input[data-v-1be22086] {\r\n  width: 50%;\n}\n.laybox2 ul[data-v-1be22086] {\r\n  margin: 33px auto;\r\n  border-bottom: 1px dashed #04bbfc;\n}\n.laybox2[data-v-1be22086] {\r\n  padding: 60px;\r\n  font-size: 16px;\n}\n.laybox2 li[data-v-1be22086] {\r\n  width: 300px;\r\n  text-align: left;\r\n  margin: 33px auto;\n}\n.t-c[data-v-1be22086]:after {\r\n  content: "";\r\n  display: block;\r\n  height: 0;\r\n  clear: both;\n}\n.bot > div[data-v-1be22086] {\r\n  position: relative;\n}\ndiv.bot[data-v-1be22086] {\r\n  margin: 45px auto 35px auto;\r\n  height: 100px;\n}\ndiv.bot span[data-v-1be22086] {\r\n  display: inline-block;\r\n  width: 20%;\n}\ndiv.bot input[data-v-1be22086] {\r\n  display: inline-block;\r\n  width: 55%;\r\n  outline: none;\r\n  border: none;\r\n  border-bottom: 1px solid #aaa;\n}\ndiv.bot button[data-v-1be22086] {\r\n  width: 110px;\r\n  height: 36px;\r\n  margin-left: -55px;\r\n  position: absolute;\r\n  border-radius: 18px;\r\n  -webkit-box-shadow: 4px 0px 6px rgba(177, 42, 19, 0.2);\r\n          box-shadow: 4px 0px 6px rgba(177, 42, 19, 0.2);\r\n  border: none;\r\n  color: #fff;\r\n  left: 50%;\r\n  top: 60px;\n}\nbutton.reject[data-v-1be22086] {\r\n  background: rgba(237, 81, 55, 1);\r\n  margin-right: 30%;\n}\nbutton.pass[data-v-1be22086] {\r\n  background-color: #20a0ff;\n}\n.left[data-v-1be22086] {\r\n  float: left;\r\n  width: 50%;\n}\n.right[data-v-1be22086] {\r\n  float: right;\r\n  width: 50%;\n}\n.nowrap[data-v-1be22086] {\r\n  width: 120px !important;\r\n  text-align: center;\r\n  white-space: nowrap; /*规定文本不换行**/\r\n  text-overflow: ellipsis; /**显示省略符号来代表被修剪的文本。*/\r\n  overflow: hidden;\r\n  margin: 0 auto;\n}\n.regionDetail[data-v-1be22086] .el-dialog__title {\r\n  font-size: 22px;\n}\n.regionDetail[data-v-1be22086] .el-dialog__body {\r\n  padding: 0px 25px 30px;\r\n  border-top: solid 2px #eee;\n}\n[data-v-1be22086] .el-dialog {\r\n  min-height: 300px;\n}\r\n',"",{version:3,sources:["F:/仲达集团/2020-3-18总后台管理系统/src/pages/Setup/channel/src/pages/Setup/channel/Receipt.vue"],names:[],mappings:";AAg1BA;EACA,aAAA;EACA,iBAAA;EACA,wBAAA;EACA,qBAAA;EACA,6BAAA;EACA,sBAAA;CACA;AACA;EACA,kBAAA;EACA,kBAAA;EACA,eAAA;CACA;AACA;EACA,gBAAA;EACA,iCAAA;CACA;AACA;EACA,gBAAA;EACA,iBAAA;CACA;AACA;EACA,YAAA;EACA,aAAA;CACA;AACA;EACA,WAAA;CACA;AACA;EACA,kBAAA;EACA,kCAAA;CACA;AAEA;EACA,cAAA;EACA,gBAAA;CACA;AAEA;EACA,aAAA;EACA,iBAAA;EACA,kBAAA;CACA;AAEA;EACA,YAAA;EACA,eAAA;EACA,UAAA;EACA,YAAA;CACA;AAEA;EACA,mBAAA;CACA;AAEA;EACA,4BAAA;EACA,cAAA;CACA;AAEA;EACA,sBAAA;EACA,WAAA;CACA;AAEA;EACA,sBAAA;EACA,WAAA;EACA,cAAA;EACA,aAAA;EACA,8BAAA;CACA;AAEA;EACA,aAAA;EACA,aAAA;EACA,mBAAA;EACA,mBAAA;EACA,oBAAA;EACA,uDAAA;UAAA,+CAAA;EACA,aAAA;EACA,YAAA;EACA,UAAA;EACA,UAAA;CACA;AAEA;EACA,iCAAA;EACA,kBAAA;CACA;AAEA;EACA,0BAAA;CACA;AAEA;EACA,YAAA;EACA,WAAA;CACA;AAEA;EACA,aAAA;EACA,WAAA;CACA;AACA;EACA,wBAAA;EACA,mBAAA;EACA,oBAAA,CAAA,YAAA;EACA,wBAAA,CAAA,qBAAA;EACA,iBAAA;EACA,eAAA;CACA;AACA;EACA,gBAAA;CACA;AACA;EACA,uBAAA;EACA,2BAAA;CACA;AAEA;EACA,kBAAA;CACA",file:"Receipt.vue",sourcesContent:['<template>\r\n  <div>\r\n    <ctbHead>\r\n      <router-link :class="seCurId==item.id? \'cur\':\'\'"\r\n                   v-for="item in authList"\r\n                   :key="item.id"\r\n                   :to="{path:item.action,query:{id:curId}}"\r\n                   :v-key="item.id">\r\n        {{item.name}}\r\n      </router-link>\r\n    </ctbHead>\r\n    <div class="container">\r\n      <div class="quote">\r\n        <div class="quote-ele">\r\n          <i></i>系统设置-免费保养设置-领卡渠道\r\n          <el-button type="primary"\r\n                     style="float:right;margin:20px 40px 0 0"\r\n                     @click="addVisible=true,state=1,openAdd(true)">添加</el-button>\r\n        </div>\r\n        <div class="quote-nav">\r\n          <router-link :class="thCurId==item.id? \'cur\':\'\'"\r\n                       v-for="item in threeAuthList"\r\n                       :key="item.id"\r\n                       :to="{path:item.action,query:{id:curId}}">\r\n            {{item.name}}\r\n          </router-link>\r\n        </div>\r\n      </div>\r\n      <div style="margin-left:20px">\r\n        <el-select v-model="province"\r\n                   placeholder="请选择所查询的地区"\r\n                   @change="page=1,init()">\r\n          <el-option value="1"\r\n                     label="全国">全国</el-option>\r\n          <el-option v-for="(item,index) in provinceList"\r\n                     :key="index"\r\n                     :label="item.label"\r\n                     :value="item.id"></el-option>\r\n        </el-select>\r\n      </div>\r\n      <el-table :data="list"\r\n                v-loading="tableLoading">\r\n        \x3c!-- <el-table-column label="图片"\r\n                         align="center">\r\n          <template slot-scope="scope">\r\n            <img :src="scope.row.photo"\r\n                 class="img">\r\n          </template>\r\n        </el-table-column> --\x3e\r\n        <el-table-column align="center"\r\n                         prop="company"\r\n                         label="名称">\r\n\r\n        </el-table-column>\r\n        <el-table-column label="渠道类型"\r\n                         align="center"\r\n                         prop="channel_type_name">\r\n\r\n        </el-table-column>\r\n        <el-table-column align="center"\r\n                         prop="num"\r\n                         label="生成数量/次">\r\n        </el-table-column>\r\n        <el-table-column align="center"\r\n                         prop="sur_num"\r\n                         label="剩余数量">\r\n        </el-table-column>\r\n        <el-table-column align="center"\r\n                         label="激活码详情">\r\n          <template slot-scope="scope">\r\n            <el-button type="text"\r\n                       @click="codeDetails(scope.row)">详情</el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column align="center"\r\n                         label="地区">\r\n          <template slot-scope="scope">\r\n            <el-popover placement="bottom"\r\n                        width="400"\r\n                        trigger="click">\r\n              <el-button type="text"\r\n                         slot="reference">详情</el-button>\r\n              <div class="areaDetails">\r\n                <h4 style="text-align:center">地区详情</h4>\r\n                <div v-if="scope.row.province">\r\n                  <span style="float:left;width:80%;">\r\n                    <div v-for="(item,index) in scope.row.province"\r\n                         :key="index"\r\n                         class="area">\r\n                      <p class="province"> {{item.province_name}}</p>\r\n                      <p class="city">{{item.city_name ? item.city_name.join(\'、\') : \'\'}}</p>\r\n                    </div>\r\n                  </span>\r\n                </div>\r\n                <div v-else\r\n                     style="text-align:center;line-height:100px;font-size:18px">\r\n                  无\r\n                </div>\r\n              </div>\r\n            </el-popover>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column align="center"\r\n                         prop="create_time"\r\n                         label="创建时间">\r\n        </el-table-column>\r\n        <el-table-column label="操作/是否显示"\r\n                         align="center"\r\n                         min-width="140px">\r\n          <template slot-scope="scope">\r\n            <el-switch :active-value=\'1\'\r\n                       :inactive-value=\'2\'\r\n                       active-color="#13ce66"\r\n                       inactive-color="#ff4949"\r\n                       v-model="scope.row.status"\r\n                       @change=\'Setup(scope.row)\'>\r\n\r\n            </el-switch>\r\n\r\n            <el-button type="primary"\r\n                       size="mini"\r\n                       style="margin-left:10px"\r\n                       @click="addVisible=true,state=2,defaultData(scope.row)">修改</el-button>\r\n            <el-button type="primary"\r\n                       size="mini"\r\n                       @click="createCode(scope.row,scope.$index)"\r\n                       :loading="codeLoading[scope.$index]"\r\n                       :disabled="scope.row.sur_num >0">生成激活码</el-button>\r\n            <el-button type="primary"\r\n                       size="mini"\r\n                       @click="exportCode(scope.row,true)"\r\n                       :loading="exportLoading[scope.$index]">导出</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      \x3c!-- 分页 --\x3e\r\n      <div class="page_center">\r\n        <paging :page-count="pageCount"\r\n                :page="page"\r\n                @index="paging"></paging>\r\n\r\n      </div>\r\n    </div>\r\n    <el-dialog center\r\n               :title="state==1 ? \'添加\': \'修改\'"\r\n               :visible.sync="addVisible"\r\n               @close=\'()=>{\r\n                   $refs.form.resetFields();\r\n                   $refs.tree.setCheckedKeys([]);\r\n                   cardNum="";\r\n                   remainingNum=""\r\n               }\'>\r\n      <el-form label-width="100px"\r\n               :model="listQuery"\r\n               :rules="rules"\r\n               ref="form">\r\n        <el-form-item label="名称:"\r\n                      prop="company">\r\n          <el-input placeholder="请输出名称"\r\n                    class="input"\r\n                    v-model="listQuery.company" />\r\n        </el-form-item>\r\n        \x3c!-- <el-form-item prop="type_channel"\r\n                      label="显示类型:">\r\n          <el-radio-group v-model="listQuery.type_channel">\r\n            <el-radio :label="1">保险公司</el-radio>\r\n            <el-radio :label="2">领卡渠道</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label="类型:"\r\n                      prop="type">\r\n          <el-radio v-model="listQuery.type"\r\n                    :label="1">五折养护</el-radio>\r\n          <el-radio v-model="listQuery.type"\r\n                    :label="2">单次免费</el-radio>\r\n        </el-form-item>\r\n        <el-form-item label="联系电话"\r\n                      prop="phone">\r\n          <el-input class="input"\r\n                    v-model="listQuery.phone"\r\n                    placeholder="请输入联系电话" />\r\n        </el-form-item> --\x3e\r\n        <el-form-item :label="state==1 ? \'卡数量\' : \'消耗数量\'"\r\n                      prop="num">\r\n          <span v-if="state!=1">\r\n            {{cardNum-remainingNum}}\r\n            +\r\n\r\n          </span>\r\n          <el-input class="input"\r\n                    v-model="listQuery.num"\r\n                    placeholder="请输入卡数量" />\r\n        </el-form-item>\r\n        \x3c!-- <el-form-item label="地址"\r\n                      required>\r\n          <el-col :span="5">\r\n            <el-form-item prop="province_name">\r\n              <el-select v-model="listQuery.province_name"\r\n                         placeholder="请选择省"\r\n                         @change="provinceChange">\r\n                <el-option v-for="(item,index) in provinceList"\r\n                           :key="index"\r\n                           :value="item.label"\r\n                           :label="item.label"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col class="line"\r\n                  style="text-align:center"\r\n                  :span="1">-</el-col>\r\n          <el-col :span="5">\r\n            <el-form-item prop="city">\r\n              <el-select v-model="listQuery.city"\r\n                         placeholder="请选择市"\r\n                         @change="cityChange">\r\n                <el-option v-for="(item,index) in cityList"\r\n                           :key="index"\r\n                           :value="item.label"\r\n                           :label="item.label"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n\r\n          <el-col class="line"\r\n                  style="text-align:center"\r\n                  :span="1">-</el-col>\r\n          <el-col :span="5">\r\n            <el-form-item prop="county">\r\n              <el-select v-model="listQuery.county"\r\n                         placeholder="请选择区/县">\r\n                <el-option v-for="(item,index) in countyList"\r\n                           :key="index"\r\n                           :value="item.name"\r\n                           :label="item.name"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n\r\n        </el-form-item>\r\n        <el-form-item label="详细地址"\r\n                      prop="address">\r\n          <el-input class="input"\r\n                    v-model="listQuery.address"\r\n                    placeholder="请输入详细地址" />\r\n        </el-form-item> --\x3e\r\n        <el-form-item label="地区">\r\n          <div>\r\n            <el-checkbox v-model="checkAll"\r\n                         @change="checkAllChange">全选</el-checkbox>\r\n          </div>\r\n          <el-tree :data="provinceList"\r\n                   show-checkbox\r\n                   node-key="id"\r\n                   ref="tree"\r\n                   :default-checked-keys="defaultAll"\r\n                   props=""\r\n                   @check=\'treeCheck\'>\r\n          </el-tree>\r\n        </el-form-item>\r\n        \x3c!-- <el-form-item label="地区:"\r\n                      prop="provinceID">\r\n          <el-checkbox :indeterminate="isIndeterminate"\r\n                       v-model="checkAll"\r\n                       @change="handleCheckAllChange">全选</el-checkbox>\r\n          <div style="margin: 15px 0;"></div>\r\n\r\n          <el-checkbox v-for="(item,index) in provinceList"\r\n                       style="width:70px"\r\n                       :label="item.id"\r\n                       :key="item.id"\r\n                       v-model="listQuery.provinceID"\r\n                       :indeterminate="item.isIndeterminate"\r\n                       @change="((val,$event)=>handleCheckedCitiesChange(val,$event,index))">\r\n            <p @click.prevent="getCity(item.id,index,$event)">\r\n              {{item.name}}\r\n            </p>\r\n\r\n          </el-checkbox>\r\n\r\n        </el-form-item> --\x3e\r\n        \x3c!-- <el-form-item label="图片:"\r\n                      prop="photo">\r\n          <el-upload :action="`${uploadUrl}admin/SystemSetup/uploadPic`"\r\n                     list-type="picture-card"\r\n                     :on-success=\'handleSuccess\'\r\n                     :data="{token:token}"\r\n                     :file-list="listQuery.photo  ?  [{url:listQuery.photo}] : []"\r\n                     name="image"\r\n                     :limit=\'1\'>\r\n\r\n            <i class="el-icon-plus"></i>\r\n          </el-upload>\r\n        </el-form-item> --\x3e\r\n        <el-form-item>\r\n          <el-button type="primary"\r\n                     @click="state==1? add() : Modify()"\r\n                     :loading="loading">{{state==1 ? \'添加\' : \'修改\'}}</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n    <el-dialog title="激活码详情"\r\n               center\r\n               :visible.sync="codeVisible">\r\n      <el-table :data="codeList">\r\n        <el-table-column label="用户名称"\r\n                         prop="name"\r\n                         align="center"></el-table-column>\r\n        <el-table-column label="联系电话"\r\n                         prop="phone"\r\n                         align="center"></el-table-column>\r\n        <el-table-column label="维修厂名称"\r\n                         prop="company"\r\n                         align="center"></el-table-column>\r\n        <el-table-column label="激活码"\r\n                         prop="code"\r\n                         align="center"></el-table-column>\r\n        <el-table-column label="状态"\r\n                         align="center">\r\n          <template>\r\n            已使用\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <div class="page_center">\r\n        <paging :page-count="codePageCount"\r\n                :page="codePage"\r\n                @index="(e)=>{\r\n                    codePage = e;\r\n                    codeDetails(currentCode)\r\n                }"></paging>\r\n\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script type="text/ecmascript-6">\r\nimport { getPro, GET_City, get_County, AccordingName_findID } from \'@/utils/index\'\r\nexport default {\r\n  data () {\r\n    return {\r\n      list: [],\r\n      token: window.sessionStorage.getItem(\'bbytoken\'),\r\n      page: 0,\r\n      pageCount: 0,\r\n      authList: [],\r\n      uploadUrl: this.baseURL,\r\n      threeAuthList: [],\r\n      addVisible: false,\r\n      tableLoading: false,\r\n      loading: false,\r\n      province: \'\',\r\n      listQuery: {\r\n        company: \'\',\r\n        type_channel: 2,\r\n        type: 2,\r\n        phone: \'\', //联系电话\r\n        num: 500, //卡数量\r\n        // province_name: \'\',\r\n        // city: \'\',\r\n        // county: \'\',\r\n        // address: "",\r\n        // photo: \'\',\r\n        provinceID: [],\r\n      },\r\n      state: 1, // 1 添加 2 修改\r\n      provinceList: [],\r\n      isIndeterminate: false,  //省是否全选中\r\n      checkAll: false,\r\n      rules: {\r\n        company: { required: true, message: \'名称不能为空\', trigger: \'blur\' },\r\n        // type: { required: true, message: \'请选择类型\', trigger: \'blur\' },\r\n        // photo: { required: true, message: \'请上传图片\', trigger: \'blur\' },\r\n        // provinceID: { required: true, message: \'请选择区域\', trigger: \'blur\' },\r\n        // type_channel: { required: true, message: \'请选择显示类型\', trigger: \'blur\' },\r\n        // phone: { required: true, message: \'联系电话不能为空\', trigger: \'blur\' },\r\n        num: { required: true, message: \'卡数量不能为空\', trigger: \'blur\' },\r\n        // province_name: { required: true, message: \'省不能为空\', trigger: \'blur\' },\r\n        // city: { required: true, message: \'市不能为空\', trigger: \'blur\' },\r\n        // county: { required: true, message: \'区/县不能为空\', trigger: \'blur\' },\r\n        // address: { required: true, message: \'详细地址不能为空\', trigger: \'blur\' },\r\n      },\r\n      cityList: [], //市列表\r\n      cityVisible: false, //是否显示市详情 默认不显示\r\n      cityIsIndeterminate: false,\r\n      cityCheckAll: false,\r\n      cityChecked: [],\r\n      provinceID: [],//所有省id\r\n      cityID: [], //所有市id\r\n      provinceIndex: 0, //当前选中的省下标\r\n      currentCity: [],  //当前选择省下面的市,\r\n      defaultAll: [],  //默认全选,\r\n      getCheckedKeys: [],\r\n      countyList: [], //区县列表\r\n      codeLoading: [], //生成激活码按钮loading\r\n      exportLoading: [], //导出loading\r\n      codeVisible: false, //激活码详情弹框\r\n      codeList: [], //激活码列表\r\n      codePageCount: 1,\r\n      codePage: 1,\r\n      currentCode: {},\r\n      cardNum: \'\',//卡数量\r\n      remainingNum: \'\'\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    isAllChecked () {\r\n      let provinceLength = this.provinceList.length;   //所有的省长度\r\n      let provinceCheckedLength = this.listQuery.provinceID.length  //当前选中的省长度\r\n      let cityCheckedLength = this.cityChecked.length;  //当前选中的市长度\r\n      let city = []\r\n      this.provinceList.forEach(item => {\r\n        item.city.forEach(v => {\r\n          city.push(v)\r\n        })\r\n      })\r\n      return provinceLength == provinceCheckedLength && city.length == cityCheckedLength\r\n    }\r\n  },\r\n  watch: {\r\n    "listQuery.province_name": {\r\n      deep: true, //深度监听设置为 true\r\n      handler (name) {\r\n        name && this.provinceChange(name)\r\n      }\r\n    },\r\n    "listQuery.city": {\r\n      deep: true, //深度监听设置为 true\r\n      handler (name) {\r\n        name && this.cityChange(name)\r\n      }\r\n    },\r\n    "listQuery.county": {\r\n      deep: true, //深度监听设置为 true\r\n      handler (name) {\r\n\r\n      }\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    paging (e) {\r\n      this.page = e;\r\n      this.init()\r\n    },\r\n    async init () {\r\n      this.tableLoading = true\r\n      let [list, getAreaList] = await Promise.all([this.getList(), this.getArea()])\r\n      this.list = list.data.data.list || []\r\n      this.pageCount = list.data.data.rows || 1;\r\n      //   console.log(getAreaList)\r\n      this.provinceList = getAreaList || []\r\n      this.tableLoading = false\r\n    },\r\n    async getList () {\r\n      return await this.$axios.post(\'admin/SystemSetup/systemLists\', { token: this.token, page: this.page, province: this.province })\r\n    },\r\n    async openAdd (checked, defaultData) {  //获取全部省\r\n      // this.provinceList = this.areaWhetherChecked()\r\n      this.$nextTick(() => {\r\n        this.$refs.tree.setCheckedKeys(this.defaultAll)\r\n        this.getCheckedKeys = this.$refs.tree.getCheckedKeys()   //获取被选中的id\r\n        this.checkAll = true\r\n      })\r\n    },\r\n    getArea () {    //获取地区\r\n      return new Promise(async (resolve, reject) => {\r\n        try {\r\n          let data = await getPro();\r\n          let list = []\r\n\r\n          data.forEach(async (item, index) => {\r\n            let city = await GET_City(item.id)\r\n            let children = []\r\n            city.forEach(e => {\r\n              children.push({ id: e.id, label: e.name })\r\n              this.defaultAll.push(e.id)\r\n            })\r\n            list.push({ id: item.id, label: item.name, children: children })\r\n            this.defaultAll.push(item.id) //默认全选\r\n          })\r\n          resolve(list)\r\n        } catch (error) {\r\n          reject(error)\r\n        }\r\n      })\r\n    },\r\n    // areaWhetherChecked (checked) {   //checked 是否全选\r\n    //   let provinceList = this.provinceList\r\n    //   provinceList.forEach(item => {\r\n    //     item = Object.assign(item, { checked: checked });\r\n    //     item.city.forEach(v => {\r\n    //       v = Object.assign(v, { checked: checked })\r\n    //       if (checked) {\r\n    //         this.cityChecked.push(v.id)\r\n    //       }\r\n    //     })\r\n    //     if (checked) {\r\n    //       this.listQuery.provinceID.push(item.id)\r\n    //     }\r\n    //   })\r\n    //   return provinceList;\r\n    // },\r\n\r\n    checkAllChange () {  //全选\r\n      this.$refs.tree.setCheckedKeys(this.checkAll ? this.defaultAll : [])\r\n    },\r\n    treeCheck () {\r\n      this.checkAll = this.$refs.tree.getCheckedKeys().length == this.defaultAll.length //是否全选\r\n    },\r\n    defaultData (row) {  //修改       默认数据\r\n      this.cardNum = row.num\r\n      this.remainingNum = row.sur_num\r\n      let province = row.province;\r\n      let provinceID = [];\r\n      let cityID = [];\r\n      let iSnational = false\r\n      Object.keys(province).forEach(key => {   //获取需要默认选中的id\r\n        let province_id = province[key].province_id;\r\n        let city_id = province[key].city_id\r\n        if (province_id) {\r\n          provinceID.push(province_id)\r\n        }\r\n        if (city_id) {\r\n          cityID.push(...city_id)\r\n        }\r\n        iSnational = province[key].province_name == \'全国\' ? true : false; //是否是全国\r\n      })\r\n      this.$nextTick(() => {\r\n        this.getCheckedKeys = this.$refs.tree.getCheckedKeys()   //获取被选中的id\r\n        this.$refs.tree.setCheckedKeys(iSnational ? this.defaultAll : cityID);\r\n        this.listQuery = Object.assign(this.listQuery, row)\r\n        this.checkAll = iSnational\r\n      })\r\n      //   let provinceList = this.provinceList\r\n      //   provinceList.forEach(item => {   //根据选中的id匹配 进行设置选中\r\n      //     provinceID.forEach(v => {\r\n      //       if (item.id == v) {\r\n      //         item.checked = true\r\n      //       }\r\n      //     })\r\n      //     item.city.forEach(v => {\r\n      //       cityID.forEach(e => {\r\n      //         if (v.id == e) {\r\n      //           v.checked = true\r\n      //         }\r\n      //       })\r\n      //     })\r\n      //   })\r\n      //   this.provinceList = provinceList  //重新渲染\r\n      //   let { provinceCheckedID, cityCheckedId } = this.getAreaCheckedID();   //获取选中的省id 和选中的市id\r\n      //   this.$nextTick(() => {\r\n      //     this.listQuery = Object.assign(this.listQuery, { company: row.company, type: row.type, photo: row.photo, provinceID: provinceCheckedID, id: row.id, type_channel: row.type_channel })   //设置省默认选中状态\r\n      //   })\r\n      //   this.cityChecked = cityCheckedId  //设置市默认选中状态\r\n      //   this.isIndeterminate = provinceCheckedID.length < this.provinceList.length && provinceCheckedID.length > 0\r\n      //   this.checkAll = provinceID.length == this.provinceList.length;\r\n    },\r\n\r\n\r\n    // handleCheckAllChange (val) {  //地区全选功能\r\n    //   let provinceList = [];\r\n    //   let provinceID = []\r\n    //   this.provinceList.forEach((el, index) => {  //获取所有省id  \r\n    //     this.provinceList[index].checked = val;\r\n    //     el.city.forEach((item, i) => {\r\n    //       this.provinceList[index].city[i].checked = this.checkAll\r\n    //     })\r\n    //     provinceID.push(el.id)\r\n    //   });\r\n    //   let { provinceCheckedID, cityCheckedId } = this.getAreaCheckedID();\r\n    //   this.listQuery.provinceID = provinceCheckedID;\r\n    //   this.cityChecked = cityCheckedId\r\n    //   this.isIndeterminate = false;\r\n    // },\r\n    // handleCheckedCitiesChange (v, e, index) {   //当前省操作  v 代表当时省是否选中  e event对象  index 当前省的下标\r\n    //   this.provinceList[index].checked = v      // 设置当前的省的选中状态\r\n    //   let length = this.listQuery.provinceID.length;   //当前省选中的长度\r\n    //   this.provinceList[index].city.forEach((item, i) => {\r\n    //     this.provinceList[index].city[i].checked = v\r\n    //   })\r\n    //   let { cityCheckedId } = this.getAreaCheckedID();\r\n    //   this.cityChecked = cityCheckedId  //市默认选中状态\r\n    //   this.isIndeterminate = length < this.provinceList.length && length > 0;      //判断当前省选中的长度是否小于当前省的长度并且当前选中省的长度大于0  如果条件成立设置全选的按钮的状态\r\n    //   console.log(length)\r\n    //   this.checkAll = length == this.provinceList.length     //当前选中省的长度如果等于当前省的长度, 省全选按钮勾选\r\n\r\n    // },\r\n\r\n    // //获取市\r\n    // async getCity (id, index, e) {\r\n    //   this.provinceIndex = index //当前选择的省下标\r\n    //   this.currentCity = this.provinceList[index].city   //当前省下面的市\r\n    //   this.cityVisible = true;   //是否显示市详情弹框\r\n    //   this.cityList = this.provinceList[index].city   //获取当前市\r\n    //   let currentCityLength = this.currentCity.length;    //当前市的长度\r\n    //   let { cityCheckedId } = this.getAreaCheckedID();   //获取已选中市的id\r\n    //   this.cityChecked = cityCheckedId    //设置市默认选中状态\r\n    //   let cityCheckedLength = this.cityCheckedLength(this.currentCity)    //当前市选中的长度\r\n    //   this.cityCheckAll = this.provinceList[index].checked ? cityCheckedLength == currentCityLength : false  //用当前市和当前选中市进行判断如果当前市的长度不等于当前选中的市的长度,则市全选不勾选,  相反如果等于全选按钮勾选\r\n\r\n\r\n    // },\r\n\r\n    // cityCheckedLength (currentCity) {    //当前选中的市的长度\r\n    //   return currentCity.filter(item => item.checked).length;\r\n    // },\r\n\r\n    // // 市全选操作\r\n    // cityCheckAllChange (val) {  //市 是否全选  val表示是否全选\r\n    //   let provinceIndex = this.provinceIndex     //获取当前选中省的下标\r\n    //   let cityID = []\r\n    //   this.provinceList[provinceIndex].city.forEach((item, index) => {\r\n    //     this.provinceList[provinceIndex].city[index].checked = val    //如果var等于true表示全选,把当前选中省下面的所有市改成选中状态,相反则改成非选中状态\r\n    //     cityID.push(item.id)\r\n    //   })\r\n    //   this.provinceList[provinceIndex].checked = val\r\n    //   let { provinceCheckedID, cityCheckedId } = this.getAreaCheckedID();   //获取当前选中市\r\n    //   this.listQuery.provinceID = provinceCheckedID\r\n    //   this.cityChecked = val ? this.provinceList[provinceIndex].checked ? cityCheckedId : cityID : []   //默认市的选中\r\n\r\n    //   this.isIndeterminate = provinceCheckedID.length < this.provinceList.length && provinceCheckedID.length > 0\r\n\r\n\r\n    // },\r\n\r\n    // getAreaCheckedID () {  //获取选中的省id和市id\r\n    //   let provinceCheckedID = [];\r\n    //   let cityCheckedId = []\r\n    //   this.provinceList.forEach(item => {\r\n    //     if (item.checked) {  //当前省是否选择\r\n    //       item.city.forEach(v => {\r\n    //         if (v.checked) {  //当前市是否选中\r\n    //           cityCheckedId.push(v.id)  //获取当前选中的市id\r\n    //         }\r\n    //       })\r\n    //       provinceCheckedID.push(item.id)   //获取当前选中的省id\r\n    //     }\r\n    //   })\r\n\r\n    //   return {\r\n    //     provinceCheckedID,\r\n    //     cityCheckedId\r\n    //   }\r\n    // },\r\n    // //当前市的操作\r\n    // cityChange (v, e, index) { // v:当前市是否被选中 e:event对象\r\n    //   this.cityList[index].checked = v;\r\n    //   let cityCheckedLength = this.cityCheckedLength(this.currentCity);\r\n    //   this.cityCheckAll = cityCheckedLength == this.currentCity.length;\r\n    //   console.log(cityCheckedLength)\r\n\r\n    //   this.provinceList[this.provinceIndex].checked = cityCheckedLength == 0 ? false : true\r\n\r\n    //   let { provinceCheckedID } = this.getAreaCheckedID();\r\n    //   this.listQuery.provinceID = provinceCheckedID;\r\n    //   console.log(cityCheckedLength, \'cityCheckedLength\', \'-----\', this.currentCity.length)\r\n    //   this.isIndeterminate = cityCheckedLength < this.currentCity.length && cityCheckedLength > 0\r\n\r\n    // },\r\n    handleSuccess (res) {  //上传成功\r\n      this.listQuery = Object.assign({}, this.listQuery, { photo: res })\r\n    },\r\n    provinceChange (name) {  //获取市\r\n      let cityList = []\r\n      this.provinceList.forEach(item => {\r\n        if (item.label == name) {\r\n          cityList = item.children\r\n        }\r\n      })\r\n      this.cityList = cityList\r\n    },\r\n    async cityChange (name) {   //\r\n      let cityCheckedId = name && AccordingName_findID(this.cityList, name)    //获取当前市id\r\n      const countyList = await get_County(cityCheckedId)  //获取区县列表\r\n      this.countyList = countyList\r\n    },\r\n\r\n\r\n    getCityCheckedID (getCheckedKeys) {   //获取选中的市ID\r\n      let cityID = []\r\n      let provinceID = []\r\n      this.provinceList.forEach(item => {   //获取所有省id\r\n        provinceID.push(item.id)\r\n      })\r\n      getCheckedKeys.forEach(item => {  //过滤掉省id 只需要市id\r\n        if (!provinceID.includes(item)) {\r\n          cityID.push(item)\r\n        }\r\n      })\r\n      return cityID\r\n    },\r\n    add () {  //添加\r\n      console.log(this.listQuery)\r\n\r\n      this.$refs.form.validate(async (valid) => {\r\n        if (valid) {\r\n          try {\r\n            this.getCityCheckedID(this.$refs.tree.getCheckedKeys())  //获取被选中的市id\r\n            let isCheckedAll = this.$refs.tree.getCheckedKeys().length == this.getCheckedKeys.length\r\n            this.loading = true\r\n            let data = (({ company, type, photo, type_channel, phone, num, province_name, city, address, county }) => ({ company, type, photo, type_channel, phone, num, province_name, city, address, county }))(this.listQuery);\r\n            let province = this.getCityCheckedID(this.$refs.tree.getCheckedKeys()) && this.getCityCheckedID(this.$refs.tree.getCheckedKeys()).length > 0 ? this.getCityCheckedID(this.$refs.tree.getCheckedKeys()).join(\',\') : \'\'\r\n            const res = await this.$axios.post(\'admin/SystemSetup/addGenre\', Object.assign({}, data, { token: this.token, types: 1, province: isCheckedAll ? 1 : province }))\r\n            this.loading = false\r\n            if (res.data.code == 1) {\r\n              this.$message({ message: res.data.msg, type: \'success\' })\r\n              this.addVisible = false\r\n              this.exportCode(Object.assign(this.listQuery, { id: res.data.data }))\r\n              this.init()\r\n            } else {\r\n              this.$message.error(res.data.msg)\r\n            }\r\n          } catch (error) {\r\n            this.loading = false\r\n            throw (error)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    //修改\r\n    Modify () {\r\n      this.$refs.form.validate(async (valid) => {\r\n        if (valid) {\r\n          try {\r\n            this.loading = true\r\n            let isCheckedAll = this.$refs.tree.getCheckedKeys().length == this.getCheckedKeys.length\r\n            let data = (({ company, type, photo, type_channel, phone, num, province_name, city, address, id, county }) => ({ company, type, photo, type_channel, phone, num, province_name, city, address, id, county }))(this.listQuery);\r\n            let province = this.getCityCheckedID(this.$refs.tree.getCheckedKeys()) && this.getCityCheckedID(this.$refs.tree.getCheckedKeys()).length > 0 ? this.getCityCheckedID(this.$refs.tree.getCheckedKeys()).join(\',\') : \'\'\r\n            const res = await this.$axios.post(\'admin/SystemSetup/updateInfo\', Object.assign({}, data, { token: this.token, types: 1, province: isCheckedAll ? 1 : province }))\r\n            this.loading = false\r\n            if (res.data.code == 1) {\r\n              this.$message({ message: res.data.msg, type: \'success\' })\r\n              this.addVisible = false\r\n              this.exportCode(this.listQuery)\r\n              this.init()\r\n\r\n            } else {\r\n              this.$message.error(res.data.msg)\r\n            }\r\n          } catch (error) {\r\n            this.loading = false\r\n            throw (error)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    //设置 显示 隐藏\r\n    async Setup (row) {\r\n      try {\r\n        const res = await this.$axios.post(\'admin/SystemSetup/updateStatus\', { token: this.token, id: row.id, status: row.status })\r\n        if (res.data.code == 1) {\r\n          this.$message({ message: res.data.msg, type: \'success\' })\r\n          this.init()\r\n        } else {\r\n          this.$message.error(res.data.msg)\r\n        }\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n    },\r\n    //激活码详情\r\n    async codeDetails (item) {\r\n      try {\r\n        this.codeVisible = true\r\n        this.currentCode = item\r\n        const res = await this.$axios.post("admin/SystemSetup/codeDetail", { token: this.token, id: item.id, page: this.codePage })\r\n        this.codeList = res.data.data.list || []\r\n        this.codePageCount = res.data.data.rows || 1\r\n      } catch (error) {\r\n        throw (error)\r\n      }\r\n    },\r\n    //生成激活码\r\n    createCode (item, index) {\r\n      this.$confirm(`您确定要生成${item.num}个激活码吗?`, \'提示\', {\r\n        confirmButtonText: \'确定\',\r\n        cancelButtonText: \'取消\',\r\n        type: \'warning\'\r\n      }).then(async () => {\r\n        try {\r\n          this.codeLoading[index] = true\r\n          const res = await this.$axios.post("admin/SystemSetup/createCode", { token: this.token, id: item.id, num: item.num })\r\n          this.codeLoading[index] = false\r\n          if (res.data.code == 1) {\r\n            this.$message({ message: res.data.msg, type: "success" })\r\n            this.init()\r\n          } else {\r\n            this.$message.error(res.data.msg)\r\n          }\r\n        } catch (error) {\r\n          this.codeLoading[index] = false\r\n          throw (error)\r\n        }\r\n      }).catch(() => { });\r\n\r\n    },\r\n    //导出激活码\r\n    exportCode (item, manualExport) {\r\n      console.log(item)\r\n      window.location.href = `${this.baseURL}admin/Login/freeCode?id=${item.id}&name=${item.company}&num=${manualExport ? \'\' : Number(item.num) + (Number(this.cardNum) - Number(this.remainingNum))}`\r\n    },\r\n    erAuth () {  //权限匹配\r\n      var id = this.$route.query.id;\r\n      this.curId = id;\r\n\r\n      this.$axios.post(\'admin/Auth/erAuth\', {\r\n        token: window.sessionStorage.getItem(\'bbytoken\'),\r\n        id: id\r\n      })\r\n        .then(res => {\r\n          if (res.data.code == 1) {\r\n            var arr = res.data.data;\r\n            for (var i = 0; i < arr.length; i++) {\r\n              if (arr[i].son) {\r\n                if (arr[i].name == \'免费保养设置\') {\r\n                  this.seCurId = arr[i].id;\r\n                  this.threeAuthList = arr[i].son;\r\n                }\r\n                for (var j = 0; j < arr[i].son.length; j++) {\r\n                  if (arr[i].action != arr[i].son[j].action) {\r\n                    arr[i].action = arr[i].son[0].action;\r\n                  }\r\n                  if (arr[i].son[j].name == \'领卡渠道\' && arr[i].name == \'免费保养设置\') {\r\n                    this.thCurId = arr[i].son[j].id;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            this.authList = arr;\r\n          } else {\r\n            this.$alert(res.data.msg, \'提示\', { type: \'error\' });\r\n          }\r\n        })\r\n        .catch(err => {\r\n          alert(err);\r\n        })\r\n    }\r\n  },\r\n  mounted () {\r\n    this.erAuth();\r\n    this.init();\r\n  },\r\n}\r\n<\/script>\r\n<style scoped>\r\n.ellipsis {\r\n  width: 150px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 2;\r\n}\r\n.areaDetails {\r\n  max-height: 300px;\r\n  min-height: 100px;\r\n  overflow: auto;\r\n}\r\n.areaDetails .area {\r\n  padding: 10px 0;\r\n  border-bottom: 1px solid #cccccc;\r\n}\r\n.areaDetails .province {\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n}\r\n.img {\r\n  width: 70px;\r\n  height: 70px;\r\n}\r\n.input {\r\n  width: 50%;\r\n}\r\n.laybox2 ul {\r\n  margin: 33px auto;\r\n  border-bottom: 1px dashed #04bbfc;\r\n}\r\n\r\n.laybox2 {\r\n  padding: 60px;\r\n  font-size: 16px;\r\n}\r\n\r\n.laybox2 li {\r\n  width: 300px;\r\n  text-align: left;\r\n  margin: 33px auto;\r\n}\r\n\r\n.t-c:after {\r\n  content: "";\r\n  display: block;\r\n  height: 0;\r\n  clear: both;\r\n}\r\n\r\n.bot > div {\r\n  position: relative;\r\n}\r\n\r\ndiv.bot {\r\n  margin: 45px auto 35px auto;\r\n  height: 100px;\r\n}\r\n\r\ndiv.bot span {\r\n  display: inline-block;\r\n  width: 20%;\r\n}\r\n\r\ndiv.bot input {\r\n  display: inline-block;\r\n  width: 55%;\r\n  outline: none;\r\n  border: none;\r\n  border-bottom: 1px solid #aaa;\r\n}\r\n\r\ndiv.bot button {\r\n  width: 110px;\r\n  height: 36px;\r\n  margin-left: -55px;\r\n  position: absolute;\r\n  border-radius: 18px;\r\n  box-shadow: 4px 0px 6px rgba(177, 42, 19, 0.2);\r\n  border: none;\r\n  color: #fff;\r\n  left: 50%;\r\n  top: 60px;\r\n}\r\n\r\nbutton.reject {\r\n  background: rgba(237, 81, 55, 1);\r\n  margin-right: 30%;\r\n}\r\n\r\nbutton.pass {\r\n  background-color: #20a0ff;\r\n}\r\n\r\n.left {\r\n  float: left;\r\n  width: 50%;\r\n}\r\n\r\n.right {\r\n  float: right;\r\n  width: 50%;\r\n}\r\n.nowrap {\r\n  width: 120px !important;\r\n  text-align: center;\r\n  white-space: nowrap; /*规定文本不换行**/\r\n  text-overflow: ellipsis; /**显示省略符号来代表被修剪的文本。*/\r\n  overflow: hidden;\r\n  margin: 0 auto;\r\n}\r\n.regionDetail >>> .el-dialog__title {\r\n  font-size: 22px;\r\n}\r\n.regionDetail >>> .el-dialog__body {\r\n  padding: 0px 25px 30px;\r\n  border-top: solid 2px #eee;\r\n}\r\n\r\n>>> .el-dialog {\r\n  min-height: 300px;\r\n}\r\n</style>\r\n'],sourceRoot:""}])},jFbC:function(e,n,t){t("Cdx3"),e.exports=t("FeBl").Object.keys},uqUo:function(e,n,t){var r=t("kM2E"),i=t("FeBl"),a=t("S82l");e.exports=function(e,n){var t=(i.Object||{})[e]||Object[e],s={};s[e]=n(t),r(r.S+r.F*a(function(){t(1)}),"Object",s)}}});
//# sourceMappingURL=6.aa09c9133999bbb46595.js.map